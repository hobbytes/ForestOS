<?$appname=$_GET['appname'];$appid=$_GET['appid'];?>
<div id="<?echo $appname.$appid;?>" style="background-color:#1b1b1b; height:500px; color:#f2f2f2; width:800px; border-radius:0px 0px 5px 5px; overflow:hidden;">
<?php
/*Console*/
//Подключаем библиотеки

//Инициализируем переменные
$click=$_GET['mobile'];
$appdownload=$_GET['appdownload'];
$type=$_GET['type'];
$folder=$_GET['destination'];
$text=preg_replace('#%u([0-9A-F]{4})#se','iconv("UTF-16BE","UTF-8",pack("H4","$1"))',$_GET["command"]);
//Логика
?>
<style>
#canvas {
    position: relative;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
    margin: 0 auto;
    border: 0px solid #555;
}
</style>


<input type="hidden" id="nivel" value="">
<input type="hidden" id="idpuerta" value="">
<canvas id="canvas" style="width: 100%;height: 100%; image-rendering: -webkit-optimize-contrast;"></canvas>

<script>
/*! Built with IMPACT - impactjs.com */

(function(window){"use strict";Number.prototype.map=function(istart,istop,ostart,ostop){return ostart+(ostop-ostart)*((this-istart)/(istop-istart));};Number.prototype.limit=function(min,max){return Math.min(max,Math.max(min,this));};Number.prototype.round=function(precision){precision=Math.pow(10,precision||0);return Math.round(this*precision)/precision;};Number.prototype.floor=function(){return Math.floor(this);};Number.prototype.ceil=function(){return Math.ceil(this);};Number.prototype.toInt=function(){return(this|0);};Number.prototype.toRad=function(){return(this/180)*Math.PI;};Number.prototype.toDeg=function(){return(this*180)/Math.PI;};Array.prototype.erase=function(item){for(var i=this.length;i--;){if(this[i]===item){this.splice(i,1);}}
return this;};Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)];};Function.prototype.bind=Function.prototype.bind||function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");}
var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,fNOP=function(){},fBound=function(){return fToBind.apply((this instanceof fNOP&&oThis?this:oThis),aArgs.concat(Array.prototype.slice.call(arguments)));};fNOP.prototype=this.prototype;fBound.prototype=new fNOP();return fBound;};window.ig={game:null,debug:null,version:'1.21',global:window,modules:{},resources:[],ready:false,baked:false,nocache:'',ua:{},prefix:(window.ImpactPrefix||''),lib:'lib/',_current:null,_loadQueue:[],_waitForOnload:0,$:function(selector){return selector.charAt(0)=='#'?document.getElementById(selector.substr(1)):document.getElementsByTagName(selector);},$new:function(name){return document.createElement(name);},copy:function(object){if(!object||typeof(object)!='object'||object instanceof HTMLElement||object instanceof ig.Class){return object;}
else if(object instanceof Array){var c=[];for(var i=0,l=object.length;i<l;i++){c[i]=ig.copy(object[i]);}
return c;}
else{var c={};for(var i in object){c[i]=ig.copy(object[i]);}
return c;}},merge:function(original,extended){for(var key in extended){var ext=extended[key];if(typeof(ext)!='object'||ext instanceof HTMLElement||ext instanceof ig.Class){original[key]=ext;}
else{if(!original[key]||typeof(original[key])!='object'){original[key]=(ext instanceof Array)?[]:{};}
ig.merge(original[key],ext);}}
return original;},ksort:function(obj){if(!obj||typeof(obj)!='object'){return[];}
var keys=[],values=[];for(var i in obj){keys.push(i);}
keys.sort();for(var i=0;i<keys.length;i++){values.push(obj[keys[i]]);}
return values;},setVendorAttribute:function(el,attr,val){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);el[attr]=el['ms'+uc]=el['moz'+uc]=el['webkit'+uc]=el['o'+uc]=val;},getVendorAttribute:function(el,attr){var uc=attr.charAt(0).toUpperCase()+attr.substr(1);return el[attr]||el['ms'+uc]||el['moz'+uc]||el['webkit'+uc]||el['o'+uc];},normalizeVendorAttribute:function(el,attr){var prefixedVal=ig.getVendorAttribute(el,attr);if(!el[attr]&&prefixedVal){el[attr]=prefixedVal;}},getImagePixels:function(image,x,y,width,height){var canvas=ig.$new('canvas');canvas.width=image.width;canvas.height=image.height;var ctx=canvas.getContext('2d');var ratio=ig.getVendorAttribute(ctx,'backingStorePixelRatio')||1;ig.normalizeVendorAttribute(ctx,'getImageDataHD');var realWidth=image.width/ratio,realHeight=image.height/ratio;canvas.width=Math.ceil(realWidth);canvas.height=Math.ceil(realHeight);ctx.drawImage(image,0,0,realWidth,realHeight);return(ratio===1)?ctx.getImageData(x,y,width,height):ctx.getImageDataHD(x,y,width,height);},module:function(name){if(ig._current){throw("Module '"+ig._current.name+"' defines nothing");}
if(ig.modules[name]&&ig.modules[name].body){throw("Module '"+name+"' is already defined");}
ig._current={name:name,requires:[],loaded:false,body:null};ig.modules[name]=ig._current;ig._loadQueue.push(ig._current);return ig;},requires:function(){ig._current.requires=Array.prototype.slice.call(arguments);return ig;},defines:function(body){ig._current.body=body;ig._current=null;ig._initDOMReady();},addResource:function(resource){ig.resources.push(resource);},setNocache:function(set){ig.nocache=set?'?'+Date.now():'';},log:function(){},assert:function(condition,msg){},show:function(name,number){},mark:function(msg,color){},_loadScript:function(name,requiredFrom){ig.modules[name]={name:name,requires:[],loaded:false,body:null};ig._waitForOnload++;var path=ig.prefix+ig.lib+name.replace(/\./g,'/')+'.js'+ig.nocache;var script=ig.$new('script');script.type='text/javascript';script.src=path;script.onload=function(){ig._waitForOnload--;ig._execModules();};script.onerror=function(){throw('Failed to load module '+name+' at '+path+' '+'required from '+requiredFrom);};ig.$('head')[0].appendChild(script);},_execModules:function(){var modulesLoaded=false;for(var i=0;i<ig._loadQueue.length;i++){var m=ig._loadQueue[i];var dependenciesLoaded=true;for(var j=0;j<m.requires.length;j++){var name=m.requires[j];if(!ig.modules[name]){dependenciesLoaded=false;ig._loadScript(name,m.name);}
else if(!ig.modules[name].loaded){dependenciesLoaded=false;}}
if(dependenciesLoaded&&m.body){ig._loadQueue.splice(i,1);m.loaded=true;m.body();modulesLoaded=true;i--;}}
if(modulesLoaded){ig._execModules();}
else if(!ig.baked&&ig._waitForOnload==0&&ig._loadQueue.length!=0){var unresolved=[];for(var i=0;i<ig._loadQueue.length;i++){var unloaded=[];var requires=ig._loadQueue[i].requires;for(var j=0;j<requires.length;j++){var m=ig.modules[requires[j]];if(!m||!m.loaded){unloaded.push(requires[j]);}}
unresolved.push(ig._loadQueue[i].name+' (requires: '+unloaded.join(', ')+')');}
throw('Unresolved (circular?) dependencies. '+"Most likely there's a name/path mismatch for one of the listed modules:\n"+
unresolved.join('\n'));}},_DOMReady:function(){if(!ig.modules['dom.ready'].loaded){if(!document.body){return setTimeout(ig._DOMReady,13);}
ig.modules['dom.ready'].loaded=true;ig._waitForOnload--;ig._execModules();}
return 0;},_boot:function(){if(document.location.href.match(/\?nocache/)){ig.setNocache(true);}
ig.ua.pixelRatio=window.devicePixelRatio||1;ig.ua.viewport={width:window.innerWidth,height:window.innerHeight};ig.ua.screen={width:window.screen.availWidth*ig.ua.pixelRatio,height:window.screen.availHeight*ig.ua.pixelRatio};ig.ua.iPhone=/iPhone/i.test(navigator.userAgent);ig.ua.iPhone4=(ig.ua.iPhone&&ig.ua.pixelRatio==2);ig.ua.iPad=/iPad/i.test(navigator.userAgent);ig.ua.android=/android/i.test(navigator.userAgent);ig.ua.iOS=ig.ua.iPhone||ig.ua.iPad;ig.ua.mobile=ig.ua.iOS||ig.ua.android;},_initDOMReady:function(){if(ig.modules['dom.ready']){ig._execModules();return;}
ig._boot();ig.modules['dom.ready']={requires:[],loaded:false,body:null};ig._waitForOnload++;if(document.readyState==='complete'){ig._DOMReady();}
else{document.addEventListener('DOMContentLoaded',ig._DOMReady,false);window.addEventListener('load',ig._DOMReady,false);}}};ig.normalizeVendorAttribute(window,'requestAnimationFrame');if(window.requestAnimationFrame){var next=1,anims={};window.ig.setAnimation=function(callback,element){var current=next++;anims[current]=true;var animate=function(){if(!anims[current]){return;}
window.requestAnimationFrame(animate,element);callback();};window.requestAnimationFrame(animate,element);return current;};window.ig.clearAnimation=function(id){delete anims[id];};}
else{window.ig.setAnimation=function(callback,element){return window.setInterval(callback,1000/60);};window.ig.clearAnimation=function(id){window.clearInterval(id);};}
var initializing=false,fnTest=/xyz/.test(function(){xyz;})?/\bparent\b/:/.*/;window.ig.Class=function(){};var inject=function(prop){var proto=this.prototype;var parent={};for(var name in prop){if(typeof(prop[name])=="function"&&typeof(proto[name])=="function"&&fnTest.test(prop[name])){parent[name]=proto[name];proto[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{proto[name]=prop[name];}}};window.ig.Class.extend=function(prop){var parent=this.prototype;initializing=true;var prototype=new this();initializing=false;for(var name in prop){if(typeof(prop[name])=="function"&&typeof(parent[name])=="function"&&fnTest.test(prop[name])){prototype[name]=(function(name,fn){return function(){var tmp=this.parent;this.parent=parent[name];var ret=fn.apply(this,arguments);this.parent=tmp;return ret;};})(name,prop[name]);}
else{prototype[name]=prop[name];}}
function Class(){if(!initializing){if(this.staticInstantiate){var obj=this.staticInstantiate.apply(this,arguments);if(obj){return obj;}}
for(var p in this){if(typeof(this[p])=='object'){this[p]=ig.copy(this[p]);}}
if(this.init){this.init.apply(this,arguments);}}
return this;}
Class.prototype=prototype;Class.prototype.constructor=Class;Class.extend=window.ig.Class.extend;Class.inject=inject;return Class;};})(window);

// lib/impact/image.js
ig.baked=true;ig.module('impact.image').defines(function(){"use strict";ig.Image=ig.Class.extend({data:null,width:0,height:0,loaded:false,failed:false,loadCallback:null,path:'',staticInstantiate:function(path){return ig.Image.cache[path]||null;},init:function(path){this.path=path;this.load();},load:function(loadCallback){if(this.loaded){if(loadCallback){loadCallback(this.path,true);}
return;}
else if(!this.loaded&&ig.ready){this.loadCallback=loadCallback||null;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.onerror=this.onerror.bind(this);this.data.src=ig.prefix+this.path+ig.nocache;}
else{ig.addResource(this);}
ig.Image.cache[this.path]=this;},reload:function(){this.loaded=false;this.data=new Image();this.data.onload=this.onload.bind(this);this.data.src=this.path+'?'+Date.now();},onload:function(event){this.width=this.data.width;this.height=this.data.height;this.loaded=true;if(ig.system.scale!=1){this.resize(ig.system.scale);}
if(this.loadCallback){this.loadCallback(this.path,true);}},onerror:function(event){this.failed=true;if(this.loadCallback){this.loadCallback(this.path,false);}},resize:function(scale){var origPixels=ig.getImagePixels(this.data,0,0,this.width,this.height);var widthScaled=this.width*scale;var heightScaled=this.height*scale;var scaled=ig.$new('canvas');scaled.width=widthScaled;scaled.height=heightScaled;var scaledCtx=scaled.getContext('2d');var scaledPixels=scaledCtx.getImageData(0,0,widthScaled,heightScaled);for(var y=0;y<heightScaled;y++){for(var x=0;x<widthScaled;x++){var index=(Math.floor(y/scale)*this.width+Math.floor(x/scale))*4;var indexScaled=(y*widthScaled+x)*4;scaledPixels.data[indexScaled]=origPixels.data[index];scaledPixels.data[indexScaled+1]=origPixels.data[index+1];scaledPixels.data[indexScaled+2]=origPixels.data[index+2];scaledPixels.data[indexScaled+3]=origPixels.data[index+3];}}
scaledCtx.putImageData(scaledPixels,0,0);this.data=scaled;},draw:function(targetX,targetY,sourceX,sourceY,width,height){if(!this.loaded){return;}
var scale=ig.system.scale;sourceX=sourceX?sourceX*scale:0;sourceY=sourceY?sourceY*scale:0;width=(width?width:this.width)*scale;height=(height?height:this.height)*scale;ig.system.context.drawImage(this.data,sourceX,sourceY,width,height,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),width,height);ig.Image.drawCount++;},drawTile:function(targetX,targetY,tile,tileWidth,tileHeight,flipX,flipY){tileHeight=tileHeight?tileHeight:tileWidth;if(!this.loaded||tileWidth>this.width||tileHeight>this.height){return;}
var scale=ig.system.scale;var tileWidthScaled=Math.floor(tileWidth*scale);var tileHeightScaled=Math.floor(tileHeight*scale);var scaleX=flipX?-1:1;var scaleY=flipY?-1:1;if(flipX||flipY){ig.system.context.save();ig.system.context.scale(scaleX,scaleY);}
ig.system.context.drawImage(this.data,(Math.floor(tile*tileWidth)%this.width)*scale,(Math.floor(tile*tileWidth/this.width)*tileHeight)*scale,tileWidthScaled,tileHeightScaled,ig.system.getDrawPos(targetX)*scaleX-(flipX?tileWidthScaled:0),ig.system.getDrawPos(targetY)*scaleY-(flipY?tileHeightScaled:0),tileWidthScaled,tileHeightScaled);if(flipX||flipY){ig.system.context.restore();}
ig.Image.drawCount++;}});ig.Image.drawCount=0;ig.Image.cache={};ig.Image.reloadCache=function(){for(var path in ig.Image.cache){ig.Image.cache[path].reload();}};});

// lib/impact/font.js
ig.baked=true;ig.module('impact.font').requires('impact.image').defines(function(){"use strict";ig.Font=ig.Image.extend({widthMap:[],indices:[],firstChar:32,alpha:1,letterSpacing:1,lineSpacing:0,onload:function(ev){this._loadMetrics(this.data);this.parent(ev);},widthForString:function(text){if(text.indexOf('\n')!==-1){var lines=text.split('\n');var width=0;for(var i=0;i<lines.length;i++){width=Math.max(width,this._widthForLine(lines[i]));}
return width;}
else{return this._widthForLine(text);}},_widthForLine:function(text){var width=0;for(var i=0;i<text.length;i++){width+=this.widthMap[text.charCodeAt(i)-this.firstChar]+this.letterSpacing;}
return width;},heightForString:function(text){return text.split('\n').length*(this.height+this.lineSpacing);},draw:function(text,x,y,align){if(typeof(text)!='string'){text=text.toString();}
if(text.indexOf('\n')!==-1){var lines=text.split('\n');var lineHeight=this.height+this.lineSpacing;for(var i=0;i<lines.length;i++){this.draw(lines[i],x,y+i*lineHeight,align);}
return;}
if(align==ig.Font.ALIGN.RIGHT||align==ig.Font.ALIGN.CENTER){var width=this._widthForLine(text);x-=align==ig.Font.ALIGN.CENTER?width/2:width;}
if(this.alpha!==1){ig.system.context.globalAlpha=this.alpha;}
for(var i=0;i<text.length;i++){var c=text.charCodeAt(i);x+=this._drawChar(c-this.firstChar,x,y);}
if(this.alpha!==1){ig.system.context.globalAlpha=1;}
ig.Image.drawCount+=text.length;},_drawChar:function(c,targetX,targetY){if(!this.loaded||c<0||c>=this.indices.length){return 0;}
var scale=ig.system.scale;var charX=this.indices[c]*scale;var charY=0;var charWidth=this.widthMap[c]*scale;var charHeight=(this.height-2)*scale;ig.system.context.drawImage(this.data,charX,charY,charWidth,charHeight,ig.system.getDrawPos(targetX),ig.system.getDrawPos(targetY),charWidth,charHeight);return this.widthMap[c]+this.letterSpacing;},_loadMetrics:function(image){this.height=image.height-1;this.widthMap=[];this.indices=[];var px=ig.getImagePixels(image,0,image.height-1,image.width,1);var currentChar=0;var currentWidth=0;for(var x=0;x<image.width;x++){var index=x*4+3;if(px.data[index]>127){currentWidth++;}
else if(px.data[index]==0&&currentWidth){this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);currentChar++;currentWidth=0;}}
this.widthMap.push(currentWidth);this.indices.push(x-currentWidth);}});ig.Font.ALIGN={LEFT:0,RIGHT:1,CENTER:2};});

// lib/impact/sound.js
ig.baked=true;ig.module('impact.sound').defines(function(){"use strict";ig.SoundManager=ig.Class.extend({clips:{},volume:1,format:null,init:function(){if(!ig.Sound.enabled||!window.Audio){ig.Sound.enabled=false;return;}
var probe=new Audio();for(var i=0;i<ig.Sound.use.length;i++){var format=ig.Sound.use[i];if(probe.canPlayType(format.mime)){this.format=format;break;}}
if(!this.format){ig.Sound.enabled=false;}},load:function(path,multiChannel,loadCallback){var realPath=ig.prefix+path.replace(/[^\.]+$/,this.format.ext)+ig.nocache;if(this.clips[path]){if(multiChannel&&this.clips[path].length<ig.Sound.channels){for(var i=this.clips[path].length;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return this.clips[path][0];}
var clip=new Audio(realPath);if(loadCallback){clip.addEventListener('canplaythrough',function cb(ev){clip.removeEventListener('canplaythrough',cb,false);loadCallback(path,true,ev);},false);clip.addEventListener('error',function(ev){loadCallback(path,false,ev);},false);}
clip.preload='auto';clip.load();this.clips[path]=[clip];if(multiChannel){for(var i=1;i<ig.Sound.channels;i++){var a=new Audio(realPath);a.load();this.clips[path].push(a);}}
return clip;},get:function(path){var channels=this.clips[path];for(var i=0,clip;clip=channels[i++];){if(clip.paused||clip.ended){if(clip.ended){clip.currentTime=0;}
return clip;}}
channels[0].pause();channels[0].currentTime=0;return channels[0];}});ig.Music=ig.Class.extend({tracks:[],namedTracks:{},currentTrack:null,currentIndex:0,random:false,_volume:1,_loop:false,_fadeInterval:0,_fadeTimer:null,_endedCallbackBound:null,init:function(){this._endedCallbackBound=this._endedCallback.bind(this);if(Object.defineProperty){Object.defineProperty(this,"volume",{get:this.getVolume.bind(this),set:this.setVolume.bind(this)});Object.defineProperty(this,"loop",{get:this.getLooping.bind(this),set:this.setLooping.bind(this)});}
else if(this.__defineGetter__){this.__defineGetter__('volume',this.getVolume.bind(this));this.__defineSetter__('volume',this.setVolume.bind(this));this.__defineGetter__('loop',this.getLooping.bind(this));this.__defineSetter__('loop',this.setLooping.bind(this));}},add:function(music,name){if(!ig.Sound.enabled){return;}
var path=music instanceof ig.Sound?music.path:music;var track=ig.soundManager.load(path,false);track.loop=this._loop;track.volume=this._volume;track.addEventListener('ended',this._endedCallbackBound,false);this.tracks.push(track);if(name){this.namedTracks[name]=track;}
if(!this.currentTrack){this.currentTrack=track;}},next:function(){if(!this.tracks.length){return;}
this.stop();this.currentIndex=this.random?Math.floor(Math.random()*this.tracks.length):(this.currentIndex+1)%this.tracks.length;this.currentTrack=this.tracks[this.currentIndex];this.play();},pause:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();},stop:function(){if(!this.currentTrack){return;}
this.currentTrack.pause();this.currentTrack.currentTime=0;},play:function(name){if(name&&this.namedTracks[name]){var newTrack=this.namedTracks[name];if(newTrack!=this.currentTrack){this.stop();this.currentTrack=newTrack;}}
else if(!this.currentTrack){return;}
this.currentTrack.play();},getLooping:function(){return this._loop;},setLooping:function(l){this._loop=l;for(var i in this.tracks){this.tracks[i].loop=l;}},getVolume:function(){return this._volume;},setVolume:function(v){this._volume=v.limit(0,1);for(var i in this.tracks){this.tracks[i].volume=this._volume;}},fadeOut:function(time){if(!this.currentTrack){return;}
clearInterval(this._fadeInterval);this.fadeTimer=new ig.Timer(time);this._fadeInterval=setInterval(this._fadeStep.bind(this),50);},_fadeStep:function(){var v=this.fadeTimer.delta().map(-this.fadeTimer.target,0,1,0).limit(0,1)*this._volume;if(v<=0.01){this.stop();this.currentTrack.volume=this._volume;clearInterval(this._fadeInterval);}
else{this.currentTrack.volume=v;}},_endedCallback:function(){if(this._loop){this.play();}
else{this.next();}}});ig.Sound=ig.Class.extend({path:'',volume:1,currentClip:null,multiChannel:true,init:function(path,multiChannel){this.path=path;this.multiChannel=(multiChannel!==false);this.load();},load:function(loadCallback){if(!ig.Sound.enabled){if(loadCallback){loadCallback(this.path,true);}
return;}
if(ig.ready){ig.soundManager.load(this.path,this.multiChannel,loadCallback);}
else{ig.addResource(this);}},play:function(){if(!ig.Sound.enabled){return;}
this.currentClip=ig.soundManager.get(this.path);this.currentClip.volume=ig.soundManager.volume*this.volume;this.currentClip.play();},stop:function(){if(this.currentClip){this.currentClip.pause();this.currentClip.currentTime=0;}}});ig.Sound.FORMAT={MP3:{ext:'mp3',mime:'audio/mpeg'},M4A:{ext:'m4a',mime:'audio/mp4; codecs=mp4a'},OGG:{ext:'ogg',mime:'audio/ogg; codecs=vorbis'},WEBM:{ext:'webm',mime:'audio/webm; codecs=vorbis'},CAF:{ext:'caf',mime:'audio/x-caf'}};ig.Sound.use=[ig.Sound.FORMAT.OGG,ig.Sound.FORMAT.MP3];ig.Sound.channels=4;ig.Sound.enabled=true;});

// lib/impact/loader.js
ig.baked=true;ig.module('impact.loader').requires('impact.image','impact.font','impact.sound').defines(function(){"use strict";ig.Loader=ig.Class.extend({resources:[],gameClass:null,status:0,done:false,_unloaded:[],_drawStatus:0,_intervalId:0,_loadCallbackBound:null,init:function(gameClass,resources){this.gameClass=gameClass;this.resources=resources;this._loadCallbackBound=this._loadCallback.bind(this);for(var i=0;i<this.resources.length;i++){this._unloaded.push(this.resources[i].path);}},load:function(){ig.system.clear('#000');if(!this.resources.length){this.end();return;}
for(var i=0;i<this.resources.length;i++){this.loadResource(this.resources[i]);}
this._intervalId=setInterval(this.draw.bind(this),16);},loadResource:function(res){res.load(this._loadCallbackBound);},end:function(){if(this.done){return;}
this.done=true;clearInterval(this._intervalId);ig.system.setGame(this.gameClass);},draw:function(){this._drawStatus+=(this.status-this._drawStatus)/5;var s=ig.system.scale;var w=ig.system.width*0.6;var h=ig.system.height*0.1;var x=ig.system.width*0.5-w/2;var y=ig.system.height*0.5-h/2;ig.system.context.fillStyle='#000';ig.system.context.fillRect(0,0,480,320);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s,h*s);ig.system.context.fillStyle='#000';ig.system.context.fillRect(x*s+s,y*s+s,w*s-s-s,h*s-s-s);ig.system.context.fillStyle='#fff';ig.system.context.fillRect(x*s,y*s,w*s*this._drawStatus,h*s);},_loadCallback:function(path,status){if(status){this._unloaded.erase(path);}
else{throw('Failed to load resource: '+path);}
this.status=1-(this._unloaded.length/this.resources.length);if(this._unloaded.length==0){setTimeout(this.end.bind(this),250);}}});});

// lib/impact/timer.js
ig.baked=true;ig.module('impact.timer').defines(function(){"use strict";ig.Timer=ig.Class.extend({target:0,base:0,last:0,pausedAt:0,init:function(seconds){this.base=ig.Timer.time;this.last=ig.Timer.time;this.target=seconds||0;},set:function(seconds){this.target=seconds||0;this.base=ig.Timer.time;this.pausedAt=0;},reset:function(){this.base=ig.Timer.time;this.pausedAt=0;},tick:function(){var delta=ig.Timer.time-this.last;this.last=ig.Timer.time;return(this.pausedAt?0:delta);},delta:function(){return(this.pausedAt||ig.Timer.time)-this.base-this.target;},pause:function(){if(!this.pausedAt){this.pausedAt=ig.Timer.time;}},unpause:function(){if(this.pausedAt){this.base+=ig.Timer.time-this.pausedAt;this.pausedAt=0;}}});ig.Timer._last=0;ig.Timer.time=Number.MIN_VALUE;ig.Timer.timeScale=1;ig.Timer.maxStep=0.05;ig.Timer.step=function(){var current=Date.now();var delta=(current-ig.Timer._last)/1000;ig.Timer.time+=Math.min(delta,ig.Timer.maxStep)*ig.Timer.timeScale;ig.Timer._last=current;};});

// lib/impact/system.js
ig.baked=true;ig.module('impact.system').requires('impact.timer','impact.image').defines(function(){"use strict";ig.System=ig.Class.extend({fps:30,width:320,height:240,realWidth:320,realHeight:240,scale:1,tick:0,animationId:0,newGameClass:null,running:false,delegate:null,clock:null,canvas:null,context:null,init:function(canvasId,fps,width,height,scale){this.fps=fps;this.clock=new ig.Timer();this.canvas=ig.$(canvasId);this.resize(width,height,scale);this.context=this.canvas.getContext('2d');this.getDrawPos=ig.System.drawMode;if(this.scale!=1){ig.System.scaleMode=ig.System.SCALE.CRISP;}
ig.System.scaleMode(this.canvas,this.context);},resize:function(width,height,scale){this.width=width;this.height=height;this.scale=scale||this.scale;this.realWidth=this.width*this.scale;this.realHeight=this.height*this.scale;this.canvas.width=this.realWidth;this.canvas.height=this.realHeight;},setGame:function(gameClass){if(this.running){this.newGameClass=gameClass;}
else{this.setGameNow(gameClass);}},setGameNow:function(gameClass){ig.game=new(gameClass)();ig.system.setDelegate(ig.game);},setDelegate:function(object){if(typeof(object.run)=='function'){this.delegate=object;this.startRunLoop();}else{throw('System.setDelegate: No run() function in object');}},stopRunLoop:function(){ig.clearAnimation(this.animationId);this.running=false;},startRunLoop:function(){this.stopRunLoop();this.animationId=ig.setAnimation(this.run.bind(this),this.canvas);this.running=true;},clear:function(color){this.context.fillStyle=color;this.context.fillRect(0,0,this.realWidth,this.realHeight);},run:function(){ig.Timer.step();this.tick=this.clock.tick();this.delegate.run();ig.input.clearPressed();if(this.newGameClass){this.setGameNow(this.newGameClass);this.newGameClass=null;}},getDrawPos:null});ig.System.DRAW={AUTHENTIC:function(p){return Math.round(p)*this.scale;},SMOOTH:function(p){return Math.round(p*this.scale);},SUBPIXEL:function(p){return p*this.scale;}};ig.System.drawMode=ig.System.DRAW.SMOOTH;ig.System.SCALE={CRISP:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',false);canvas.style.imageRendering='-moz-crisp-edges';canvas.style.imageRendering='-o-crisp-edges';canvas.style.imageRendering='-webkit-optimize-contrast';canvas.style.imageRendering='crisp-edges';canvas.style.msInterpolationMode='nearest-neighbor';},SMOOTH:function(canvas,context){ig.setVendorAttribute(context,'imageSmoothingEnabled',true);canvas.style.imageRendering='';canvas.style.msInterpolationMode='';}};ig.System.scaleMode=ig.System.SCALE.SMOOTH;});

// lib/impact/input.js
ig.baked=true;ig.module('impact.input').defines(function(){"use strict";ig.KEY={'MOUSE1':-1,'MOUSE2':-3,'MWHEEL_UP':-4,'MWHEEL_DOWN':-5,'BACKSPACE':8,'TAB':9,'ENTER':13,'PAUSE':19,'CAPS':20,'ESC':27,'SPACE':32,'PAGE_UP':33,'PAGE_DOWN':34,'END':35,'HOME':36,'LEFT_ARROW':37,'UP_ARROW':38,'RIGHT_ARROW':39,'DOWN_ARROW':40,'INSERT':45,'DELETE':46,'_0':48,'_1':49,'_2':50,'_3':51,'_4':52,'_5':53,'_6':54,'_7':55,'_8':56,'_9':57,'A':65,'B':66,'C':67,'D':68,'E':69,'F':70,'G':71,'H':72,'I':73,'J':74,'K':75,'L':76,'M':77,'N':78,'O':79,'P':80,'Q':81,'R':82,'S':83,'T':84,'U':85,'V':86,'W':87,'X':88,'Y':89,'Z':90,'NUMPAD_0':96,'NUMPAD_1':97,'NUMPAD_2':98,'NUMPAD_3':99,'NUMPAD_4':100,'NUMPAD_5':101,'NUMPAD_6':102,'NUMPAD_7':103,'NUMPAD_8':104,'NUMPAD_9':105,'MULTIPLY':106,'ADD':107,'SUBSTRACT':109,'DECIMAL':110,'DIVIDE':111,'F1':112,'F2':113,'F3':114,'F4':115,'F5':116,'F6':117,'F7':118,'F8':119,'F9':120,'F10':121,'F11':122,'F12':123,'SHIFT':16,'CTRL':17,'ALT':18,'PLUS':187,'COMMA':188,'MINUS':189,'PERIOD':190};ig.Input=ig.Class.extend({bindings:{},actions:{},presses:{},locks:{},delayedKeyup:{},isUsingMouse:false,isUsingKeyboard:false,isUsingAccelerometer:false,mouse:{x:0,y:0},accel:{x:0,y:0,z:0},initMouse:function(){if(this.isUsingMouse){return;}
this.isUsingMouse=true;var mouseWheelBound=this.mousewheel.bind(this);ig.system.canvas.addEventListener('mousewheel',mouseWheelBound,false);ig.system.canvas.addEventListener('DOMMouseScroll',mouseWheelBound,false);ig.system.canvas.addEventListener('contextmenu',this.contextmenu.bind(this),false);ig.system.canvas.addEventListener('mousedown',this.keydown.bind(this),false);ig.system.canvas.addEventListener('mouseup',this.keyup.bind(this),false);ig.system.canvas.addEventListener('mousemove',this.mousemove.bind(this),false);ig.system.canvas.addEventListener('touchstart',this.keydown.bind(this),false);ig.system.canvas.addEventListener('touchend',this.keyup.bind(this),false);ig.system.canvas.addEventListener('touchmove',this.mousemove.bind(this),false);},initKeyboard:function(){if(this.isUsingKeyboard){return;}
this.isUsingKeyboard=true;window.addEventListener('keydown',this.keydown.bind(this),false);window.addEventListener('keyup',this.keyup.bind(this),false);},initAccelerometer:function(){if(this.isUsingAccelerometer){return;}
window.addEventListener('devicemotion',this.devicemotion.bind(this),false);},mousewheel:function(event){var delta=event.wheelDelta?event.wheelDelta:(event.detail*-1);var code=delta>0?ig.KEY.MWHEEL_UP:ig.KEY.MWHEEL_DOWN;var action=this.bindings[code];if(action){this.actions[action]=true;this.presses[action]=true;this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},mousemove:function(event){var internalWidth=parseInt(ig.system.canvas.offsetWidth)||ig.system.realWidth;var scale=ig.system.scale*(internalWidth/ig.system.realWidth);var pos={left:0,top:0};if(ig.system.canvas.getBoundingClientRect){pos=ig.system.canvas.getBoundingClientRect();}
var ev=event.touches?event.touches[0]:event;this.mouse.x=(ev.clientX-pos.left)/scale;this.mouse.y=(ev.clientY-pos.top)/scale;},contextmenu:function(event){if(this.bindings[ig.KEY.MOUSE2]){event.stopPropagation();event.preventDefault();}},keydown:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keydown'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);if(event.type=='touchstart'||event.type=='mousedown'){this.mousemove(event);}
var action=this.bindings[code];if(action){this.actions[action]=true;if(!this.locks[action]){this.presses[action]=true;this.locks[action]=true;}
event.stopPropagation();event.preventDefault();}},keyup:function(event){var tag=event.target.tagName;if(tag=='INPUT'||tag=='TEXTAREA'){return;}
var code=event.type=='keyup'?event.keyCode:(event.button==2?ig.KEY.MOUSE2:ig.KEY.MOUSE1);var action=this.bindings[code];if(action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();}},devicemotion:function(event){this.accel=event.accelerationIncludingGravity;},bind:function(key,action){if(key<0){this.initMouse();}
else if(key>0){this.initKeyboard();}
this.bindings[key]=action;},bindTouch:function(selector,action){var element=ig.$(selector);var that=this;element.addEventListener('touchstart',function(ev){that.touchStart(ev,action);},false);element.addEventListener('touchend',function(ev){that.touchEnd(ev,action);},false);},unbind:function(key){var action=this.bindings[key];this.delayedKeyup[action]=true;this.bindings[key]=null;},unbindAll:function(){this.bindings={};this.actions={};this.presses={};this.locks={};this.delayedKeyup={};},state:function(action){return this.actions[action];},pressed:function(action){return this.presses[action];},released:function(action){return this.delayedKeyup[action];},clearPressed:function(){for(var action in this.delayedKeyup){this.actions[action]=false;this.locks[action]=false;}
this.delayedKeyup={};this.presses={};},touchStart:function(event,action){this.actions[action]=true;this.presses[action]=true;event.stopPropagation();event.preventDefault();return false;},touchEnd:function(event,action){this.delayedKeyup[action]=true;event.stopPropagation();event.preventDefault();return false;}});});

// lib/impact/impact.js
ig.baked=true;ig.module('impact.impact').requires('dom.ready','impact.loader','impact.system','impact.input','impact.sound').defines(function(){"use strict";ig.main=function(canvasId,gameClass,fps,width,height,scale,loaderClass){ig.system=new ig.System(canvasId,fps,width,height,scale||1);ig.input=new ig.Input();ig.soundManager=new ig.SoundManager();ig.music=new ig.Music();ig.ready=true;var loader=new(loaderClass||ig.Loader)(gameClass,ig.resources);loader.load();};});

// lib/impact/animation.js
ig.baked=true;ig.module('impact.animation').requires('impact.timer','impact.image').defines(function(){"use strict";ig.AnimationSheet=ig.Class.extend({width:8,height:8,image:null,init:function(path,width,height){this.width=width;this.height=height;this.image=new ig.Image(path);}});ig.Animation=ig.Class.extend({sheet:null,timer:null,sequence:[],flip:{x:false,y:false},pivot:{x:0,y:0},frame:0,tile:0,loopCount:0,alpha:1,angle:0,init:function(sheet,frameTime,sequence,stop){this.sheet=sheet;this.pivot={x:sheet.width/2,y:sheet.height/2};this.timer=new ig.Timer();this.frameTime=frameTime;this.sequence=sequence;this.stop=!!stop;this.tile=this.sequence[0];},rewind:function(){this.timer.set();this.loopCount=0;this.tile=this.sequence[0];return this;},gotoFrame:function(f){this.timer.set(this.frameTime*-f);this.update();},gotoRandomFrame:function(){this.gotoFrame(Math.floor(Math.random()*this.sequence.length))},update:function(){var frameTotal=Math.floor(this.timer.delta()/this.frameTime);this.loopCount=Math.floor(frameTotal/this.sequence.length);if(this.stop&&this.loopCount>0){this.frame=this.sequence.length-1;}
else{this.frame=frameTotal%this.sequence.length;}
this.tile=this.sequence[this.frame];},draw:function(targetX,targetY){var bbsize=Math.max(this.sheet.width,this.sheet.height);if(targetX>ig.system.width||targetY>ig.system.height||targetX+bbsize<0||targetY+bbsize<0){return;}
if(this.alpha!=1){ig.system.context.globalAlpha=this.alpha;}
if(this.angle==0){this.sheet.image.drawTile(targetX,targetY,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);}
else{ig.system.context.save();ig.system.context.translate(ig.system.getDrawPos(targetX+this.pivot.x),ig.system.getDrawPos(targetY+this.pivot.y));ig.system.context.rotate(this.angle);this.sheet.image.drawTile(-this.pivot.x,-this.pivot.y,this.tile,this.sheet.width,this.sheet.height,this.flip.x,this.flip.y);ig.system.context.restore();}
if(this.alpha!=1){ig.system.context.globalAlpha=1;}}});});

// lib/impact/entity.js
ig.baked=true;ig.module('impact.entity').requires('impact.animation','impact.impact').defines(function(){"use strict";ig.Entity=ig.Class.extend({id:0,settings:{},size:{x:16,y:16},offset:{x:0,y:0},pos:{x:0,y:0},last:{x:0,y:0},vel:{x:0,y:0},accel:{x:0,y:0},friction:{x:0,y:0},maxVel:{x:100,y:100},zIndex:0,gravityFactor:1,standing:false,bounciness:0,minBounceVelocity:40,anims:{},animSheet:null,currentAnim:null,health:10,type:0,checkAgainst:0,collides:0,_killed:false,slopeStanding:{min:(44).toRad(),max:(136).toRad()},init:function(x,y,settings){this.id=++ig.Entity._lastId;this.pos.x=x;this.pos.y=y;ig.merge(this,settings);},addAnim:function(name,frameTime,sequence,stop){if(!this.animSheet){throw('No animSheet to add the animation '+name+' to.');}
var a=new ig.Animation(this.animSheet,frameTime,sequence,stop);this.anims[name]=a;if(!this.currentAnim){this.currentAnim=a;}
return a;},update:function(){this.last.x=this.pos.x;this.last.y=this.pos.y;this.vel.y+=ig.game.gravity*ig.system.tick*this.gravityFactor;this.vel.x=this.getNewVelocity(this.vel.x,this.accel.x,this.friction.x,this.maxVel.x);this.vel.y=this.getNewVelocity(this.vel.y,this.accel.y,this.friction.y,this.maxVel.y);var mx=this.vel.x*ig.system.tick;var my=this.vel.y*ig.system.tick;var res=ig.game.collisionMap.trace(this.pos.x,this.pos.y,mx,my,this.size.x,this.size.y);this.handleMovementTrace(res);if(this.currentAnim){this.currentAnim.update();}},getNewVelocity:function(vel,accel,friction,max){if(accel){return(vel+accel*ig.system.tick).limit(-max,max);}
else if(friction){var delta=friction*ig.system.tick;if(vel-delta>0){return vel-delta;}
else if(vel+delta<0){return vel+delta;}
else{return 0;}}
return vel.limit(-max,max);},handleMovementTrace:function(res){this.standing=false;if(res.collision.y){if(this.bounciness>0&&Math.abs(this.vel.y)>this.minBounceVelocity){this.vel.y*=-this.bounciness;}
else{if(this.vel.y>0){this.standing=true;}
this.vel.y=0;}}
if(res.collision.x){if(this.bounciness>0&&Math.abs(this.vel.x)>this.minBounceVelocity){this.vel.x*=-this.bounciness;}
else{this.vel.x=0;}}
if(res.collision.slope){var s=res.collision.slope;if(this.bounciness>0){var proj=this.vel.x*s.nx+this.vel.y*s.ny;this.vel.x=(this.vel.x-s.nx*proj*2)*this.bounciness;this.vel.y=(this.vel.y-s.ny*proj*2)*this.bounciness;}
else{var lengthSquared=s.x*s.x+s.y*s.y;var dot=(this.vel.x*s.x+this.vel.y*s.y)/lengthSquared;this.vel.x=s.x*dot;this.vel.y=s.y*dot;var angle=Math.atan2(s.x,s.y);if(angle>this.slopeStanding.min&&angle<this.slopeStanding.max){this.standing=true;}}}
this.pos=res.pos;},draw:function(){if(this.currentAnim){this.currentAnim.draw(this.pos.x-this.offset.x-ig.game._rscreen.x,this.pos.y-this.offset.y-ig.game._rscreen.y);}},kill:function(){ig.game.removeEntity(this);},receiveDamage:function(amount,from){this.health-=amount;if(this.health<=0){this.kill();}},touches:function(other){return!(this.pos.x>=other.pos.x+other.size.x||this.pos.x+this.size.x<=other.pos.x||this.pos.y>=other.pos.y+other.size.y||this.pos.y+this.size.y<=other.pos.y);},distanceTo:function(other){var xd=(this.pos.x+this.size.x/2)-(other.pos.x+other.size.x/2);var yd=(this.pos.y+this.size.y/2)-(other.pos.y+other.size.y/2);return Math.sqrt(xd*xd+yd*yd);},angleTo:function(other){return Math.atan2((other.pos.y+other.size.y/2)-(this.pos.y+this.size.y/2),(other.pos.x+other.size.x/2)-(this.pos.x+this.size.x/2));},check:function(other){},collideWith:function(other,axis){},ready:function(){}});ig.Entity._lastId=0;ig.Entity.COLLIDES={NEVER:0,LITE:1,PASSIVE:2,ACTIVE:4,FIXED:8};ig.Entity.TYPE={NONE:0,A:1,B:2,BOTH:3};ig.Entity.checkPair=function(a,b){if(a.checkAgainst&b.type){a.check(b);}
if(b.checkAgainst&a.type){b.check(a);}
if(a.collides&&b.collides&&a.collides+b.collides>ig.Entity.COLLIDES.ACTIVE){ig.Entity.solveCollision(a,b);}};ig.Entity.solveCollision=function(a,b){var weak=null;if(a.collides==ig.Entity.COLLIDES.LITE||b.collides==ig.Entity.COLLIDES.FIXED){weak=a;}
else if(b.collides==ig.Entity.COLLIDES.LITE||a.collides==ig.Entity.COLLIDES.FIXED){weak=b;}
if(a.last.x+a.size.x>b.last.x&&a.last.x<b.last.x+b.size.x){if(a.last.y<b.last.y){ig.Entity.seperateOnYAxis(a,b,weak);}
else{ig.Entity.seperateOnYAxis(b,a,weak);}
a.collideWith(b,'y');b.collideWith(a,'y');}
else if(a.last.y+a.size.y>b.last.y&&a.last.y<b.last.y+b.size.y){if(a.last.x<b.last.x){ig.Entity.seperateOnXAxis(a,b,weak);}
else{ig.Entity.seperateOnXAxis(b,a,weak);}
a.collideWith(b,'x');b.collideWith(a,'x');}};ig.Entity.seperateOnXAxis=function(left,right,weak){var nudge=(left.pos.x+left.size.x-right.pos.x);if(weak){var strong=left===weak?right:left;weak.vel.x=-weak.vel.x*weak.bounciness+strong.vel.x;var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,weak==left?-nudge:nudge,0,weak.size.x,weak.size.y);weak.pos.x=resWeak.pos.x;}
else{var v2=(left.vel.x-right.vel.x)/2;left.vel.x=-v2;right.vel.x=v2;var resLeft=ig.game.collisionMap.trace(left.pos.x,left.pos.y,-nudge/2,0,left.size.x,left.size.y);left.pos.x=Math.floor(resLeft.pos.x);var resRight=ig.game.collisionMap.trace(right.pos.x,right.pos.y,nudge/2,0,right.size.x,right.size.y);right.pos.x=Math.ceil(resRight.pos.x);}};ig.Entity.seperateOnYAxis=function(top,bottom,weak){var nudge=(top.pos.y+top.size.y-bottom.pos.y);if(weak){var strong=top===weak?bottom:top;weak.vel.y=-weak.vel.y*weak.bounciness+strong.vel.y;var nudgeX=0;if(weak==top&&Math.abs(weak.vel.y-strong.vel.y)<weak.minBounceVelocity){weak.standing=true;nudgeX=strong.vel.x*ig.system.tick;}
var resWeak=ig.game.collisionMap.trace(weak.pos.x,weak.pos.y,nudgeX,weak==top?-nudge:nudge,weak.size.x,weak.size.y);weak.pos.y=resWeak.pos.y;weak.pos.x=resWeak.pos.x;}
else if(ig.game.gravity&&(bottom.standing||top.vel.y>0)){var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,0,-(top.pos.y+top.size.y-bottom.pos.y),top.size.x,top.size.y);top.pos.y=resTop.pos.y;if(top.bounciness>0&&top.vel.y>top.minBounceVelocity){top.vel.y*=-top.bounciness;}
else{top.standing=true;top.vel.y=0;}}
else{var v2=(top.vel.y-bottom.vel.y)/2;top.vel.y=-v2;bottom.vel.y=v2;var nudgeX=bottom.vel.x*ig.system.tick;var resTop=ig.game.collisionMap.trace(top.pos.x,top.pos.y,nudgeX,-nudge/2,top.size.x,top.size.y);top.pos.y=resTop.pos.y;var resBottom=ig.game.collisionMap.trace(bottom.pos.x,bottom.pos.y,0,nudge/2,bottom.size.x,bottom.size.y);bottom.pos.y=resBottom.pos.y;}};});

// lib/impact/map.js
ig.baked=true;ig.module('impact.map').defines(function(){"use strict";ig.Map=ig.Class.extend({tilesize:8,width:1,height:1,data:[[]],name:null,init:function(tilesize,data){this.tilesize=tilesize;this.data=data;this.height=data.length;this.width=data[0].length;},getTile:function(x,y){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){return this.data[ty][tx];}
else{return 0;}},setTile:function(x,y,tile){var tx=Math.floor(x/this.tilesize);var ty=Math.floor(y/this.tilesize);if((tx>=0&&tx<this.width)&&(ty>=0&&ty<this.height)){this.data[ty][tx]=tile;}}});});

// lib/impact/collision-map.js
ig.baked=true;ig.module('impact.collision-map').requires('impact.map').defines(function(){"use strict";ig.CollisionMap=ig.Map.extend({lastSlope:1,tiledef:null,init:function(tilesize,data,tiledef){this.parent(tilesize,data);this.tiledef=tiledef||ig.CollisionMap.defaultTileDef;for(var t in this.tiledef){if(t|0>this.lastSlope){this.lastSlope=t|0;}}},trace:function(x,y,vx,vy,objectWidth,objectHeight){var res={collision:{x:false,y:false,slope:false},pos:{x:x,y:y},tile:{x:0,y:0}};var steps=Math.ceil(Math.max(Math.abs(vx),Math.abs(vy))/this.tilesize);if(steps>1){var sx=vx/steps;var sy=vy/steps;for(var i=0;i<steps&&(sx||sy);i++){this._traceStep(res,x,y,sx,sy,objectWidth,objectHeight,vx,vy,i);x=res.pos.x;y=res.pos.y;if(res.collision.x){sx=0;vx=0;}
if(res.collision.y){sy=0;vy=0;}
if(res.collision.slope){break;}}}
else{this._traceStep(res,x,y,vx,vy,objectWidth,objectHeight,vx,vy,0);}
return res;},_traceStep:function(res,x,y,vx,vy,width,height,rvx,rvy,step){res.pos.x+=vx;res.pos.y+=vy;var t=0;if(vx){var pxOffsetX=(vx>0?width:0);var tileOffsetX=(vx<0?this.tilesize:0);var firstTileY=Math.max(Math.floor(y/this.tilesize),0);var lastTileY=Math.min(Math.ceil((y+height)/this.tilesize),this.height);var tileX=Math.floor((res.pos.x+pxOffsetX)/this.tilesize);var prevTileX=Math.floor((x+pxOffsetX)/this.tilesize);if(step>0||tileX==prevTileX||prevTileX<0||prevTileX>=this.width){prevTileX=-1;}
if(tileX>=0&&tileX<this.width){for(var tileY=firstTileY;tileY<lastTileY;tileY++){if(prevTileX!=-1){t=this.data[tileY][prevTileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,prevTileX,tileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.x=true;res.tile.x=t;x=res.pos.x=tileX*this.tilesize-pxOffsetX+tileOffsetX;rvx=0;break;}}}}
if(vy){var pxOffsetY=(vy>0?height:0);var tileOffsetY=(vy<0?this.tilesize:0);var firstTileX=Math.max(Math.floor(res.pos.x/this.tilesize),0);var lastTileX=Math.min(Math.ceil((res.pos.x+width)/this.tilesize),this.width);var tileY=Math.floor((res.pos.y+pxOffsetY)/this.tilesize);var prevTileY=Math.floor((y+pxOffsetY)/this.tilesize);if(step>0||tileY==prevTileY||prevTileY<0||prevTileY>=this.height){prevTileY=-1;}
if(tileY>=0&&tileY<this.height){for(var tileX=firstTileX;tileX<lastTileX;tileX++){if(prevTileY!=-1){t=this.data[prevTileY][tileX];if(t>1&&t<=this.lastSlope&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,prevTileY)){break;}}
t=this.data[tileY][tileX];if(t==1||t>this.lastSlope||(t>1&&this._checkTileDef(res,t,x,y,rvx,rvy,width,height,tileX,tileY))){if(t>1&&t<=this.lastSlope&&res.collision.slope){break;}
res.collision.y=true;res.tile.y=t;res.pos.y=tileY*this.tilesize-pxOffsetY+tileOffsetY;break;}}}}},_checkTileDef:function(res,t,x,y,vx,vy,width,height,tileX,tileY){var def=this.tiledef[t];if(!def){return false;}
var lx=(tileX+def[0])*this.tilesize,ly=(tileY+def[1])*this.tilesize,lvx=(def[2]-def[0])*this.tilesize,lvy=(def[3]-def[1])*this.tilesize,solid=def[4];var tx=x+vx+(lvy<0?width:0)-lx,ty=y+vy+(lvx>0?height:0)-ly;if(lvx*ty-lvy*tx>0){if(vx*-lvy+vy*lvx<0){return solid;}
var length=Math.sqrt(lvx*lvx+lvy*lvy);var nx=lvy/length,ny=-lvx/length;var proj=tx*nx+ty*ny;var px=nx*proj,py=ny*proj;if(px*px+py*py>=vx*vx+vy*vy){return solid||(lvx*(ty-vy)-lvy*(tx-vx)<0.5);}
res.pos.x=x+vx-px;res.pos.y=y+vy-py;res.collision.slope={x:lvx,y:lvy,nx:nx,ny:ny};return true;}
return false;}});var H=1/2,N=1/3,M=2/3,SOLID=true,NON_SOLID=false;ig.CollisionMap.defaultTileDef={5:[0,1,1,M,SOLID],6:[0,M,1,N,SOLID],7:[0,N,1,0,SOLID],3:[0,1,1,H,SOLID],4:[0,H,1,0,SOLID],2:[0,1,1,0,SOLID],10:[H,1,1,0,SOLID],21:[0,1,H,0,SOLID],32:[M,1,1,0,SOLID],43:[N,1,M,0,SOLID],54:[0,1,N,0,SOLID],27:[0,0,1,N,SOLID],28:[0,N,1,M,SOLID],29:[0,M,1,1,SOLID],25:[0,0,1,H,SOLID],26:[0,H,1,1,SOLID],24:[0,0,1,1,SOLID],11:[0,0,H,1,SOLID],22:[H,0,1,1,SOLID],33:[0,0,N,1,SOLID],44:[N,0,M,1,SOLID],55:[M,0,1,1,SOLID],16:[1,N,0,0,SOLID],17:[1,M,0,N,SOLID],18:[1,1,0,M,SOLID],14:[1,H,0,0,SOLID],15:[1,1,0,H,SOLID],13:[1,1,0,0,SOLID],8:[H,1,0,0,SOLID],19:[1,1,H,0,SOLID],30:[N,1,0,0,SOLID],41:[M,1,N,0,SOLID],52:[1,1,M,0,SOLID],38:[1,M,0,1,SOLID],39:[1,N,0,M,SOLID],40:[1,0,0,N,SOLID],36:[1,H,0,1,SOLID],37:[1,0,0,H,SOLID],35:[1,0,0,1,SOLID],9:[1,0,H,1,SOLID],20:[H,0,0,1,SOLID],31:[1,0,M,1,SOLID],42:[M,0,N,1,SOLID],53:[N,0,0,1,SOLID],12:[0,0,1,0,NON_SOLID],23:[1,1,0,1,NON_SOLID],34:[1,0,1,1,NON_SOLID],45:[0,1,0,0,NON_SOLID]};ig.CollisionMap.staticNoCollision={trace:function(x,y,vx,vy){return{collision:{x:false,y:false,slope:false},pos:{x:x+vx,y:y+vy},tile:{x:0,y:0}};}};});

// lib/impact/background-map.js
ig.baked=true;ig.module('impact.background-map').requires('impact.map','impact.image').defines(function(){"use strict";ig.BackgroundMap=ig.Map.extend({tiles:null,scroll:{x:0,y:0},distance:1,repeat:false,tilesetName:'',foreground:false,enabled:true,preRender:false,preRenderedChunks:null,chunkSize:512,debugChunks:false,anims:{},init:function(tilesize,data,tileset){this.parent(tilesize,data);this.setTileset(tileset);},setTileset:function(tileset){this.tilesetName=tileset instanceof ig.Image?tileset.path:tileset;this.tiles=new ig.Image(this.tilesetName);this.preRenderedChunks=null;},setScreenPos:function(x,y){this.scroll.x=x/this.distance;this.scroll.y=y/this.distance;},preRenderMapToChunks:function(){var totalWidth=this.width*this.tilesize*ig.system.scale,totalHeight=this.height*this.tilesize*ig.system.scale;var chunkCols=Math.ceil(totalWidth/this.chunkSize),chunkRows=Math.ceil(totalHeight/this.chunkSize);this.preRenderedChunks=[];for(var y=0;y<chunkRows;y++){this.preRenderedChunks[y]=[];for(var x=0;x<chunkCols;x++){var chunkWidth=(x==chunkCols-1)?totalWidth-x*this.chunkSize:this.chunkSize;var chunkHeight=(y==chunkRows-1)?totalHeight-y*this.chunkSize:this.chunkSize;this.preRenderedChunks[y][x]=this.preRenderChunk(x,y,chunkWidth,chunkHeight);}}},preRenderChunk:function(cx,cy,w,h){var tw=w/this.tilesize/ig.system.scale+1,th=h/this.tilesize/ig.system.scale+1;var nx=(cx*this.chunkSize/ig.system.scale)%this.tilesize,ny=(cy*this.chunkSize/ig.system.scale)%this.tilesize;var tx=Math.floor(cx*this.chunkSize/this.tilesize/ig.system.scale),ty=Math.floor(cy*this.chunkSize/this.tilesize/ig.system.scale);var chunk=ig.$new('canvas');chunk.width=w;chunk.height=h;var oldContext=ig.system.context;ig.system.context=chunk.getContext("2d");for(var x=0;x<tw;x++){for(var y=0;y<th;y++){if(x+tx<this.width&&y+ty<this.height){var tile=this.data[y+ty][x+tx];if(tile){this.tiles.drawTile(x*this.tilesize-nx,y*this.tilesize-ny,tile-1,this.tilesize);}}}}
ig.system.context=oldContext;return chunk;},draw:function(){if(!this.tiles.loaded||!this.enabled){return;}
if(this.preRender){this.drawPreRendered();}
else{this.drawTiled();}},drawPreRendered:function(){if(!this.preRenderedChunks){this.preRenderMapToChunks();}
var dx=ig.system.getDrawPos(this.scroll.x),dy=ig.system.getDrawPos(this.scroll.y);if(this.repeat){var w=this.width*this.tilesize*ig.system.scale;dx=(dx%w+w)%w;var h=this.height*this.tilesize*ig.system.scale;dy=(dy%h+h)%h;}
var minChunkX=Math.max(Math.floor(dx/this.chunkSize),0),minChunkY=Math.max(Math.floor(dy/this.chunkSize),0),maxChunkX=Math.ceil((dx+ig.system.realWidth)/this.chunkSize),maxChunkY=Math.ceil((dy+ig.system.realHeight)/this.chunkSize),maxRealChunkX=this.preRenderedChunks[0].length,maxRealChunkY=this.preRenderedChunks.length;if(!this.repeat){maxChunkX=Math.min(maxChunkX,maxRealChunkX);maxChunkY=Math.min(maxChunkY,maxRealChunkY);}
var nudgeY=0;for(var cy=minChunkY;cy<maxChunkY;cy++){var nudgeX=0;for(var cx=minChunkX;cx<maxChunkX;cx++){var chunk=this.preRenderedChunks[cy%maxRealChunkY][cx%maxRealChunkX];var x=-dx+cx*this.chunkSize-nudgeX;var y=-dy+cy*this.chunkSize-nudgeY;ig.system.context.drawImage(chunk,x,y);ig.Image.drawCount++;if(this.debugChunks){ig.system.context.strokeStyle='#f0f';ig.system.context.strokeRect(x,y,this.chunkSize,this.chunkSize);}
if(this.repeat&&chunk.width<this.chunkSize&&x+chunk.width<ig.system.realWidth){nudgeX=this.chunkSize-chunk.width;maxChunkX++;}}
if(this.repeat&&chunk.height<this.chunkSize&&y+chunk.height<ig.system.realHeight){nudgeY=this.chunkSize-chunk.height;maxChunkY++;}}},drawTiled:function(){var tile=0,anim=null,tileOffsetX=(this.scroll.x/this.tilesize).toInt(),tileOffsetY=(this.scroll.y/this.tilesize).toInt(),pxOffsetX=this.scroll.x%this.tilesize,pxOffsetY=this.scroll.y%this.tilesize,pxMinX=-pxOffsetX-this.tilesize,pxMinY=-pxOffsetY-this.tilesize,pxMaxX=ig.system.width+this.tilesize-pxOffsetX,pxMaxY=ig.system.height+this.tilesize-pxOffsetY;for(var mapY=-1,pxY=pxMinY;pxY<pxMaxY;mapY++,pxY+=this.tilesize){var tileY=mapY+tileOffsetY;if(tileY>=this.height||tileY<0){if(!this.repeat){continue;}
tileY=(tileY%this.height+this.height)%this.height;}
for(var mapX=-1,pxX=pxMinX;pxX<pxMaxX;mapX++,pxX+=this.tilesize){var tileX=mapX+tileOffsetX;if(tileX>=this.width||tileX<0){if(!this.repeat){continue;}
tileX=(tileX%this.width+this.width)%this.width;}
if((tile=this.data[tileY][tileX])){if((anim=this.anims[tile-1])){anim.draw(pxX,pxY);}
else{this.tiles.drawTile(pxX,pxY,tile-1,this.tilesize);}}}}}});});

// lib/impact/game.js
ig.baked=true;ig.module('impact.game').requires('impact.impact','impact.entity','impact.collision-map','impact.background-map').defines(function(){"use strict";ig.Game=ig.Class.extend({clearColor:'#000000',gravity:0,screen:{x:0,y:0},_rscreen:{x:0,y:0},entities:[],namedEntities:{},collisionMap:ig.CollisionMap.staticNoCollision,backgroundMaps:[],backgroundAnims:{},autoSort:false,sortBy:null,cellSize:64,_deferredKill:[],_levelToLoad:null,_doSortEntities:false,staticInstantiate:function(){this.sortBy=this.sortBy||ig.Game.SORT.Z_INDEX;ig.game=this;return null;},loadLevel:function(data){this.screen={x:0,y:0};this.entities=[];this.namedEntities={};for(var i=0;i<data.entities.length;i++){var ent=data.entities[i];this.spawnEntity(ent.type,ent.x,ent.y,ent.settings);}
this.sortEntities();this.collisionMap=ig.CollisionMap.staticNoCollision;this.backgroundMaps=[];for(var i=0;i<data.layer.length;i++){var ld=data.layer[i];if(ld.name=='collision'){this.collisionMap=new ig.CollisionMap(ld.tilesize,ld.data);}
else{var newMap=new ig.BackgroundMap(ld.tilesize,ld.data,ld.tilesetName);newMap.anims=this.backgroundAnims[ld.tilesetName]||{};newMap.repeat=ld.repeat;newMap.distance=ld.distance;newMap.foreground=!!ld.foreground;newMap.preRender=!!ld.preRender;newMap.name=ld.name;this.backgroundMaps.push(newMap);}}
for(var i=0;i<this.entities.length;i++){this.entities[i].ready();}},loadLevelDeferred:function(data){this._levelToLoad=data;},getMapByName:function(name){if(name=='collision'){return this.collisionMap;}
for(var i=0;i<this.backgroundMaps.length;i++){if(this.backgroundMaps[i].name==name){return this.backgroundMaps[i];}}
return null;},getEntityByName:function(name){return this.namedEntities[name];},getEntitiesByType:function(type){var entityClass=typeof(type)==='string'?ig.global[type]:type;var a=[];for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(ent instanceof entityClass&&!ent._killed){a.push(ent);}}
return a;},spawnEntity:function(type,x,y,settings){var entityClass=typeof(type)==='string'?ig.global[type]:type;if(!entityClass){throw("Can't spawn entity of type "+type);}
var ent=new(entityClass)(x,y,settings||{});this.entities.push(ent);if(ent.name){this.namedEntities[ent.name]=ent;}
return ent;},sortEntities:function(){this.entities.sort(this.sortBy);},sortEntitiesDeferred:function(){this._doSortEntities=true;},removeEntity:function(ent){if(ent.name){delete this.namedEntities[ent.name];}
ent._killed=true;ent.type=ig.Entity.TYPE.NONE;ent.checkAgainst=ig.Entity.TYPE.NONE;ent.collides=ig.Entity.COLLIDES.NEVER;this._deferredKill.push(ent);},run:function(){this.update();this.draw();},update:function(){if(this._levelToLoad){this.loadLevel(this._levelToLoad);this._levelToLoad=null;}
if(this._doSortEntities||this.autoSort){this.sortEntities();this._doSortEntities=false;}
this.updateEntities();this.checkEntities();for(var i=0;i<this._deferredKill.length;i++){this.entities.erase(this._deferredKill[i]);}
this._deferredKill=[];for(var tileset in this.backgroundAnims){var anims=this.backgroundAnims[tileset];for(var a in anims){anims[a].update();}}},updateEntities:function(){for(var i=0;i<this.entities.length;i++){var ent=this.entities[i];if(!ent._killed){ent.update();}}},draw:function(){if(this.clearColor){ig.system.clear(this.clearColor);}
this._rscreen.x=ig.system.getDrawPos(this.screen.x)/ig.system.scale;this._rscreen.y=ig.system.getDrawPos(this.screen.y)/ig.system.scale;var mapIndex;for(mapIndex=0;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];if(map.foreground){break;}
map.setScreenPos(this.screen.x,this.screen.y);map.draw();}
this.drawEntities();for(mapIndex;mapIndex<this.backgroundMaps.length;mapIndex++){var map=this.backgroundMaps[mapIndex];map.setScreenPos(this.screen.x,this.screen.y);map.draw();}},drawEntities:function(){for(var i=0;i<this.entities.length;i++){this.entities[i].draw();}},checkEntities:function(){var hash={};for(var e=0;e<this.entities.length;e++){var entity=this.entities[e];if(entity.type==ig.Entity.TYPE.NONE&&entity.checkAgainst==ig.Entity.TYPE.NONE&&entity.collides==ig.Entity.COLLIDES.NEVER){continue;}
var checked={},xmin=Math.floor(entity.pos.x/this.cellSize),ymin=Math.floor(entity.pos.y/this.cellSize),xmax=Math.floor((entity.pos.x+entity.size.x)/this.cellSize)+1,ymax=Math.floor((entity.pos.y+entity.size.y)/this.cellSize)+1;for(var x=xmin;x<xmax;x++){for(var y=ymin;y<ymax;y++){if(!hash[x]){hash[x]={};hash[x][y]=[entity];}
else if(!hash[x][y]){hash[x][y]=[entity];}
else{var cell=hash[x][y];for(var c=0;c<cell.length;c++){if(entity.touches(cell[c])&&!checked[cell[c].id]){checked[cell[c].id]=true;ig.Entity.checkPair(entity,cell[c]);}}
cell.push(entity);}}}}}});ig.Game.SORT={Z_INDEX:function(a,b){return a.zIndex-b.zIndex;},POS_X:function(a,b){return(a.pos.x+a.size.x)-(b.pos.x+b.size.x);},POS_Y:function(a,b){return(a.pos.y+a.size.y)-(b.pos.y+b.size.y);}};});

// lib/plugins/tween.js
ig.baked=true;ig.module('plugins.tween').requires('impact.entity').defines(function(){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(el,start){var start=start||0;for(var i=0;i<this.length;++i){if(this[i]===el){return i;}}
return-1;};}
ig.Entity.prototype.tweens=[];ig.Entity.prototype._preTweenUpdate=ig.Entity.prototype.update;ig.Entity.prototype.update=function(){this._preTweenUpdate();if(this.tweens.length>0){var currentTweens=[];for(var i=0;i<this.tweens.length;i++){this.tweens[i].update();if(!this.tweens[i].complete)currentTweens.push(this.tweens[i]);}
this.tweens=currentTweens;}};ig.Entity.prototype.tween=function(props,duration,settings){var tween=new ig.Tween(this,props,duration,settings);this.tweens.push(tween);return tween;};ig.Entity.prototype.pauseTweens=function(){for(var i=0;i<this.tweens.length;i++){this.tweens[i].pause();}};ig.Entity.prototype.resumeTweens=function(){for(var i=0;i<this.tweens.length;i++){this.tweens[i].resume();}};ig.Entity.prototype.stopTweens=function(doComplete){for(var i=0;i<this.tweens.length;i++){this.tweens[i].stop(doComplete);}};ig.Tween=function(obj,properties,duration,settings){var _object=obj;var valuesStart={};var valuesEnd={};var valuesDelta={};var _elapsed=0;var timer=false;var started=false;var _props=properties;var _chained=false;this.duration=duration;this.complete=false;this.paused=false;this.easing=ig.Tween.Easing.Linear.EaseNone;this.onComplete=false;this.delay=0;this.loop=0;this.loopCount=-1;ig.merge(this,settings);this.loopNum=this.loopCount;this.chain=function(chainObj){_chained=chainObj;};this.initEnd=function(prop,from,to){if(typeof(from[prop])!=="object"){to[prop]=from[prop];}else{for(subprop in from[prop]){if(!to[prop])to[prop]={};this.initEnd(subprop,from[prop],to[prop]);}}};this.initStart=function(prop,end,from,to){if(typeof(from[prop])!=="object"){if(typeof(end[prop])!=="undefined")to[prop]=from[prop];}else{for(subprop in from[prop]){if(!to[prop])to[prop]={};if(typeof(end[prop])!=="undefined")this.initStart(subprop,end[prop],from[prop],to[prop]);}}};this.start=function(){this.complete=false;this.paused=false;this.loopNum=this.loopCount;_elapsed=0;if(_object.tweens.indexOf(this)==-1)_object.tweens.push(this);started=true;timer=new ig.Timer();for(var property in _props){this.initEnd(property,_props,valuesEnd);}
for(var property in valuesEnd){this.initStart(property,valuesEnd,_object,valuesStart);this.initDelta(property,valuesDelta,_object,valuesEnd);}};this.initDelta=function(prop,delta,start,end){if(typeof(end[prop])!=="object"){delta[prop]=end[prop]-start[prop];}else{for(subprop in end[prop]){if(!delta[prop])delta[prop]={};this.initDelta(subprop,delta[prop],start[prop],end[prop]);}}};this.propUpdate=function(prop,obj,start,delta,value){if(typeof(start[prop])!=="object"){if(typeof start[prop]!="undefined"){obj[prop]=start[prop]+delta[prop]*value;}else{obj[prop]=obj[prop];}}else{for(subprop in start[prop]){this.propUpdate(subprop,obj[prop],start[prop],delta[prop],value);}}};this.propSet=function(prop,from,to){if(typeof(from[prop])!=="object"){to[prop]=from[prop];}else{for(subprop in from[prop]){if(!to[prop])to[prop]={};this.propSet(subprop,from[prop],to[prop]);}}};this.update=function(){if(!started)return false;if(this.delay){if(timer.delta()<this.delay)return;this.delay=0;timer.reset();}
if(this.paused||this.complete)return false;var elapsed=(timer.delta()+_elapsed)/this.duration;elapsed=elapsed>1?1:elapsed;var value=this.easing(elapsed);for(property in valuesDelta){this.propUpdate(property,_object,valuesStart,valuesDelta,value);}
if(elapsed>=1){if(this.loopNum==0||!this.loop){this.complete=true;if(this.onComplete)this.onComplete();if(_chained)_chained.start();return false;}else if(this.loop==ig.Tween.Loop.Revert){for(property in valuesStart){this.propSet(property,valuesStart,_object);}
_elapsed=0;timer.reset();if(this.loopNum!=-1)this.loopNum--;}else if(this.loop==ig.Tween.Loop.Reverse){var _start={},_end={},_delta={};ig.merge(_start,valuesEnd);ig.merge(_end,valuesStart);ig.merge(valuesStart,_start);ig.merge(valuesEnd,_end);for(property in valuesEnd){this.initDelta(property,valuesDelta,_object,valuesEnd);}
_elapsed=0;timer.reset();if(this.loopNum!=-1)this.loopNum--;}}};this.pause=function(){this.paused=true;_elapsed+=timer.delta();};this.resume=function(){this.paused=false;timer.reset();};this.stop=function(doComplete){if(doComplete){this.paused=false;this.complete=false;this.loop=false;_elapsed+=duration;this.update();}
this.complete=true;}};ig.Tween.Loop={Revert:1,Reverse:2};ig.Tween.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}};ig.Tween.Easing.Linear.EaseNone=function(k){return k;};ig.Tween.Easing.Quadratic.EaseIn=function(k){return k*k;};ig.Tween.Easing.Quadratic.EaseOut=function(k){return-k*(k-2);};ig.Tween.Easing.Quadratic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k;return-0.5*(--k*(k-2)-1);};ig.Tween.Easing.Cubic.EaseIn=function(k){return k*k*k;};ig.Tween.Easing.Cubic.EaseOut=function(k){return--k*k*k+1;};ig.Tween.Easing.Cubic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k*k;return 0.5*((k-=2)*k*k+2);};ig.Tween.Easing.Quartic.EaseIn=function(k){return k*k*k*k;};ig.Tween.Easing.Quartic.EaseOut=function(k){return-(--k*k*k*k-1);}
ig.Tween.Easing.Quartic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k*k*k;return-0.5*((k-=2)*k*k*k-2);};ig.Tween.Easing.Quintic.EaseIn=function(k){return k*k*k*k*k;};ig.Tween.Easing.Quintic.EaseOut=function(k){return(k=k-1)*k*k*k*k+1;};ig.Tween.Easing.Quintic.EaseInOut=function(k){if((k*=2)<1)return 0.5*k*k*k*k*k;return 0.5*((k-=2)*k*k*k*k+2);};ig.Tween.Easing.Sinusoidal.EaseIn=function(k){return-Math.cos(k*Math.PI/2)+1;};ig.Tween.Easing.Sinusoidal.EaseOut=function(k){return Math.sin(k*Math.PI/2);};ig.Tween.Easing.Sinusoidal.EaseInOut=function(k){return-0.5*(Math.cos(Math.PI*k)-1);};ig.Tween.Easing.Exponential.EaseIn=function(k){return k==0?0:Math.pow(2,10*(k-1));};ig.Tween.Easing.Exponential.EaseOut=function(k){return k==1?1:-Math.pow(2,-10*k)+1;};ig.Tween.Easing.Exponential.EaseInOut=function(k){if(k==0)return 0;if(k==1)return 1;if((k*=2)<1)return 0.5*Math.pow(2,10*(k-1));return 0.5*(-Math.pow(2,-10*(k-1))+2);};ig.Tween.Easing.Circular.EaseIn=function(k){return-(Math.sqrt(1-k*k)-1);};ig.Tween.Easing.Circular.EaseOut=function(k){return Math.sqrt(1-(--k*k));};ig.Tween.Easing.Circular.EaseInOut=function(k){if((k/=0.5)<1)return-0.5*(Math.sqrt(1-k*k)-1);return 0.5*(Math.sqrt(1-(k-=2)*k)+1);};ig.Tween.Easing.Elastic.EaseIn=function(k){var s,a=0.1,p=0.4;if(k==0)return 0;if(k==1)return 1;if(!p)p=0.3;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);return-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));};ig.Tween.Easing.Elastic.EaseOut=function(k){var s,a=0.1,p=0.4;if(k==0)return 0;if(k==1)return 1;if(!p)p=0.3;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);return(a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1);};ig.Tween.Easing.Elastic.EaseInOut=function(k){var s,a=0.1,p=0.4;if(k==0)return 0;if(k==1)return 1;if(!p)p=0.3;if(!a||a<1){a=1;s=p/4;}
else s=p/(2*Math.PI)*Math.asin(1/a);if((k*=2)<1)return-0.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p));return a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*0.5+1;};ig.Tween.Easing.Back.EaseIn=function(k){var s=1.70158;return k*k*((s+1)*k-s);};ig.Tween.Easing.Back.EaseOut=function(k){var s=1.70158;return(k=k-1)*k*((s+1)*k+s)+1;};ig.Tween.Easing.Back.EaseInOut=function(k){var s=1.70158*1.525;if((k*=2)<1)return 0.5*(k*k*((s+1)*k-s));return 0.5*((k-=2)*k*((s+1)*k+s)+2);};ig.Tween.Easing.Bounce.EaseIn=function(k){return 1-ig.Tween.Easing.Bounce.EaseOut(1-k);};ig.Tween.Easing.Bounce.EaseOut=function(k){if((k/=1)<(1/2.75)){return 7.5625*k*k;}else if(k<(2/2.75)){return 7.5625*(k-=(1.5/2.75))*k+0.75;}else if(k<(2.5/2.75)){return 7.5625*(k-=(2.25/2.75))*k+0.9375;}else{return 7.5625*(k-=(2.625/2.75))*k+0.984375;}};ig.Tween.Easing.Bounce.EaseInOut=function(k){if(k<0.5)return ig.Tween.Easing.Bounce.EaseIn(k*2)*0.5;return ig.Tween.Easing.Bounce.EaseOut(k*2-1)*0.5+0.5;};});

// lib/game/entities/fade.js
ig.baked=true;ig.module('game.entities.fade').requires('impact.entity').defines(function(){EntityFade=ig.Entity.extend({size:{x:640,y:480},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:400,opacidad:1,init:function(x,y,settings){this.parent(x,y,settings);this.pos.x=this.pos.y=0;this.size.x=ig.system.width;this.size.y=ig.system.height;},draw:function(){ig.system.context.globalAlpha=this.opacidad;ig.system.context.beginPath();ig.system.context.rect(0,0,ig.system.width*3,ig.system.height*3);ig.system.context.fillStyle='#000000';ig.system.context.fill();ig.system.context.globalAlpha=1;this.parent();}})});

// lib/game/entities/fondo.js
ig.baked=true;ig.module('game.entities.fondo').requires('impact.entity').defines(function(){EntityFondo=ig.Entity.extend({size:{x:21,y:68},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:10,init:function(x,y,settings){this.parent(x,y,settings);},update:function(){this.parent();},draw:function(){ig.game.fondo.draw(0,0);this.parent();}})});

// lib/game/entities/dialogbox.js
ig.baked=true;ig.module('game.entities.dialogbox').requires('impact.entity').defines(function(){EntityDialogbox=ig.Entity.extend({size:{x:320,y:45},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:600,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/dialogbox.png',320,45),nombre:'Sgt Burden',texto:'Everything OK?',dialogo:'',init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',1,[0]);this.parpadeo=new ig.Timer();},update:function(){this.parent();if(this.parpadeo.delta()>0.8)this.parpadeo.reset();if(this.pos.y>=0&&ig.input.pressed('clic')){this.tween({pos:{y:-this.size.y}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}},draw:function(){this.parent();ig.game.fontdialogg.draw(this.nombre,this.pos.x+6,this.pos.y+6,ig.Font.ALIGN.LEFT);if(this.parpadeo.delta()>0.4)ig.game.fontg.draw('>>',ig.system.width-5,this.pos.y+this.size.y-10,ig.Font.ALIGN.RIGHT);ig.game.fontdialog.draw(this.texto,this.pos.x+11,this.pos.y+17,ig.Font.ALIGN.LEFT);}})});

// lib/game/entities/prota.js
ig.baked=true;ig.module('game.entities.prota').requires('impact.entity').defines(function(){EntityProta=ig.Entity.extend({size:{x:42,y:69},offset:{x:9,y:0},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:50,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/prota-57x69.png',57,69),speed:45,destino:0,flip:false,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',1,[0]);this.addAnim('hablar',0.1,[0,1]);this.addAnim('caminado',0.1,[2,3,4,5,6,7,8,9]);this.addAnim('disparar',0.1,[10,11,12,13,14,11,10,10,10],true);this.pos.y=ig.system.height-this.size.y-15;},update:function(){this.parent();if(this.currentAnim!=this.anims.disparar){if(ig.input.pressed('clic')&&!ig.game.opciones.length&&ig.game.dialogbox.pos.y<0){this.destino=ig.input.mouse.x;if(this.pos.x>ig.input.mouse.x){this.vel.x=-this.speed;this.flip=false;}else{this.vel.x=this.speed;this.flip=true;}
this.currentAnim=this.anims.caminado;}
if(this.vel.x>0&&this.pos.x+this.size.x/2>this.destino)this.vel.x=0;if(this.vel.x<0&&this.pos.x+this.size.x/2<this.destino)this.vel.x=0;if(!this.vel.x)this.currentAnim=this.anims.idle;}else{this.vel.x=0;if(this.currentAnim.frame>=7)this.currentAnim=this.anims.idle;}
if(this.pos.x<39){this.vel.x=0;this.pos.x=39;}
this.currentAnim.flip.x=this.flip;},draw:function(){this.parent();}})});

// lib/game/entities/opcion.js
ig.baked=true;ig.module('game.entities.opcion').requires('impact.entity').defines(function(){EntityOpcion=ig.Entity.extend({size:{x:640,y:480},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:101,delay:0.6,init:function(x,y,settings){this.parent(x,y,settings);this.size.x=ig.game.font.widthForString(this.texto);this.size.y=ig.game.font.heightForString(this.texto);this.tween({pos:{y:this.pos.y-7}},this.delay,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();this.initblock=new ig.Timer();if(this.pos.x>ig.system.width/1.5)this.pos.x-=40;},update:function(){this.parent();if(ig.input.pressed('clic')&&ig.game.isClick(this)&&this.initblock.delta()>this.delay){this.initblock.reset();this.accion();this.kill();ig.game.opciones=[];}
if(ig.input.pressed('clic')&&this.initblock.delta()>this.delay){this.kill();ig.game.opciones=[];}
if(this.distanceTo(ig.game.prota)<120)ig.game.prota.vel.x=0;},draw:function(){this.parent();if(!ig.game.isClick(this))ig.game.font.draw(this.texto,this.pos.x,this.pos.y,ig.Font.ALIGN.LEFT);if(ig.game.isClick(this))ig.game.fontg.draw(this.texto,this.pos.x,this.pos.y,ig.Font.ALIGN.LEFT);}})});

// lib/game/entities/accion.js
ig.baked=true;ig.module('game.entities.accion').requires('impact.entity','game.entities.opcion').defines(function(){EntityAccion=ig.Entity.extend({size:{x:50,y:50},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:100,font:new ig.Font('<?echo $folder;?>/media/outlinedfont.png'),show:'',hover:'Look',opciones:[{texto:'',coste:0,accion:function(){}},],infecciones:[{texto:'',coste:0,accion:function(){}},],infectado:false,init:function(x,y,settings){this.parent(x,y,settings);},update:function(){if(ig.game.dialogbox.pos.y<=-ig.game.dialogbox.size.y&&ig.game.acciones>0&&ig.game.dia<40&&!ig.game.over){if(ig.game.isClick(this)&&!ig.game.opciones.length){this.show=this.hover;}else{this.show='';}

if(ig.input.pressed('clic')&&ig.game.isClick(this)&&!ig.game.opciones.length){if(this.distanceTo(ig.game.prota)<50)ig.game.prota.vel.x=0;if(this.infectado){for(var i=0;i<this.infecciones.length;i++){ig.game.opciones.push(ig.game.spawnEntity(EntityOpcion,ig.input.mouse.x-20,ig.input.mouse.y-40+i*12,{texto:this.infecciones[i].texto,coste:this.infecciones[i].coste,accion:this.infecciones[i].accion}));}}else{for(var i=0;i<this.opciones.length;i++){ig.game.opciones.push(ig.game.spawnEntity(EntityOpcion,ig.input.mouse.x-20,ig.input.mouse.y-40+i*12,{texto:this.opciones[i].texto,coste:this.opciones[i].coste,accion:this.opciones[i].accion}));}}}}else{this.show='';}},draw:function(){this.parent();this.font.draw(this.show,ig.input.mouse.x,ig.input.mouse.y-11,ig.Font.ALIGN.CENTER);}})});

// lib/game/entities/perrito.js
ig.baked=true;ig.module('game.entities.perrito').requires('impact.entity').defines(function(){EntityPerrito=ig.Entity.extend({size:{x:640,y:480},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:21,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/perrito-31x34.-9x142.png',31,34),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.2,[0,1,2,1]);this.addAnim('morir',0.1,[0,0,0,0,3,4,5,6],true);}})});

// lib/game/entities/soldado.js
ig.baked=true;ig.module('game.entities.soldado').requires('impact.entity').defines(function(){EntitySoldado=ig.Entity.extend({size:{x:68,y:75},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:22,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/soldado-68x75-7x109.png',68,75),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle1',0.1,[0,0,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]);this.addAnim('hablar1',0.1,[3,4]);this.addAnim('idle2',0.2,[6,6,6,6,6,6,6,6,7,8,9]);this.addAnim('hablar2',0.1,[5,6]);this.addAnim('idle3',0.1,[10,11,12,11]);this.addAnim('hablar3',0.1,[10,11,12,11]);this.addAnim('morir',0.1,[0,0,0,0,13,14,15,16,17,18],true);this.addAnim('infectado',1,[9]);},update:function(){this.parent();if(this.currentAnim!=this.anims.morir){if(ig.game.infectado[0]){this.currentAnim=this.anims.infectado;}else{if(ig.game.locura[0]>9)this.estado=1;if(ig.game.locura[0]<=9)this.estado=2;if(ig.game.locura[0]<=5)this.estado=3;this.currentAnim=eval('this.anims.idle'+this.estado);}}}})});

// lib/game/entities/cientifico.js
ig.baked=true;ig.module('game.entities.cientifico').requires('impact.entity').defines(function(){EntityCientifico=ig.Entity.extend({size:{x:52,y:68},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:22,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/ingeniero-52x68-234x105.png',52,68),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle1',0.1,[0,0,0,0,0,0,0,0,2,3,4,5,6,3,4,5,6,3,4,5,6,3,4,5,6,3,4,5,6,2]);this.addAnim('hablar1',0.1,[0,1]);this.addAnim('idle2',0.1,[7,8,9,10,11]);this.addAnim('hablar2',0.1,[7,8,9,10,11]);this.addAnim('idle3',0.1,[12,13,14,15]);this.addAnim('hablar3',0.1,[12,13,14,15]);this.addAnim('morir',0.1,[0,0,0,0,16,17,18,19,20,21,19,20,21,19,20,21,19,20,21],true);this.addAnim('infectado',1,[5]);},update:function(){this.parent();if(this.currentAnim!=this.anims.morir){if(ig.game.infectado[2]){this.currentAnim=this.anims.infectado;}else{if(ig.game.locura[2]>6)this.estado=1;if(ig.game.locura[2]<=5)this.estado=2;if(ig.game.locura[2]<=3)this.estado=3;this.currentAnim=eval('this.anims.idle'+this.estado);}}}})});

// lib/game/entities/doctor.js
ig.baked=true;ig.module('game.entities.doctor').requires('impact.entity').defines(function(){EntityDoctor=ig.Entity.extend({size:{x:54,y:54},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:21,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/doctor-54x54-76x123.png',54,54),estado:1,init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle1',0.1,[0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,0,1,2,6,7,8,11,10,9,9,9,9,10,11,10,10,12,13,14,15,16]);this.addAnim('hablar1',0.1,[3,4,5]);this.addAnim('idle2',0.1,[17,18,19,17,18,19,17,18,19,17,18,19,17,18,19,20,0,1,2,0,1,2,20]);this.addAnim('hablar2',0.1,[3,4,5]);this.addAnim('idle3',0.1,[21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,22,21,22,23,24,24,24,24,24,23]);this.addAnim('hablar3',0.1,[24]);this.addAnim('morir',0.1,[0,0,0,25,26,27,28],true);this.addAnim('infectado',1,[10]);},update:function(){this.parent();if(this.currentAnim!=this.anims.morir){if(ig.game.infectado[1]){this.currentAnim=this.anims.infectado;}else{if(ig.game.locura[1]>7)this.estado=1;if(ig.game.locura[1]<=7)this.estado=2;if(ig.game.locura[1]<=4)this.estado=3;this.currentAnim=eval('this.anims.idle'+this.estado);}}}});});

// lib/game/entities/chica.js
ig.baked=true;ig.module('game.entities.chica').requires('impact.entity').defines(function(){EntityChica=ig.Entity.extend({size:{x:61,y:48},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:20,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/chica-61x48-102x114.png',61,48),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle1',0.1,[0,0,0,0,0,0,1,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);this.addAnim('idle2',0.1,[4,4,4,4,4,5,6,7,6,5,4,8]);this.addAnim('idle3',0.1,[9,10,11]);this.addAnim('morir',0.1,[0,0,0,0,12,13,14],true);this.addAnim('infectado',1,[2]);},update:function(){this.parent();if(this.currentAnim!=this.anims.morir){if(ig.game.infectado[3]){this.currentAnim=this.anims.infectado;}else{if(ig.game.locura[3]>5)this.estado=1;if(ig.game.locura[3]<=5)this.estado=2;if(ig.game.locura[3]<=3)this.estado=3;this.currentAnim=eval('this.anims.idle'+this.estado);}}}})});

// lib/game/entities/robot.js
ig.baked=true;ig.module('game.entities.robot').requires('impact.entity').defines(function(){EntityRobot=ig.Entity.extend({size:{x:65,y:81},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:24,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/robot-65x81-247x113.png',65,81),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle1',0.1,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,4,5,4,5,3,2,1,6,7,8,0]);this.addAnim('morir',0.1,[0,0,0,0,9,10,11,12,13,12,13,14,12,15,16,17,18,17,18,17,18,17,18,17,18],true);},update:function(){this.parent();}})});

// lib/game/entities/hoguera.js
ig.baked=true;ig.module('game.entities.hoguera').requires('impact.entity').defines(function(){EntityHoguera=ig.Entity.extend({size:{x:70,y:57},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:25,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/hoguera-70x57-146x129.png',70,57),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('fuego0',0.1,[24]);this.addAnim('fuego1',0.1,[18,19,20,21,22,23]);this.addAnim('fuego2',0.1,[9,10,11,12,13,14,15]);this.addAnim('fuego3',0.1,[0,1,2,3,4,5,6,7,8]);this.addAnim('fuego4',0.1,[0,1,2,3,4,5,6,7,8]);},update:function(){this.parent();this.currentAnim=eval('this.anims.fuego'+ig.game.fuego);if(!ig.game.fuego)ig.game.fogata.stop();}})});

// lib/game/entities/radio.js
ig.baked=true;ig.module('game.entities.radio').requires('impact.entity').defines(function(){EntityRadio=ig.Entity.extend({size:{x:75,y:57},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:23,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/radio-75x57-245x127.png',75,57),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('radio1',1,[0]);this.addAnim('radio2',1,[1]);this.addAnim('radio3',1,[2]);},update:function(){this.parent();if(ig.game.radiostatus>=ig.game.radiomax)this.currentAnim=this.anims.radio3;if(ig.game.radiostatus<=ig.game.radiomax-1)this.currentAnim=this.anims.radio2;if(ig.game.radiostatus<=ig.game.radiomax/3)this.currentAnim=this.anims.radio1;}})});

// lib/game/entities/nave.js
ig.baked=true;ig.module('game.entities.nave').requires('impact.entity').defines(function(){EntityNave=ig.Entity.extend({size:{x:137,y:37},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:10,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/nave-137x37.png',137,37),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.1,[0,1,2,3,4,3,2,1]);this.tween({pos:{y:57}},22,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.showtitle=true;}}).start();},update:function(){this.parent();}})});

// lib/game/entities/agua.js
ig.baked=true;ig.module('game.entities.agua').requires('impact.entity').defines(function(){EntityAgua=ig.Entity.extend({size:{x:1,y:1},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:11,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/agua-302x58-6x84.png',302,58),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',0.2,[0,1,2,3,4,5,0,1,2,3,4,5,6,6,6,6,6,6,6,6,6,6,6]);}})});

// lib/game/entities/planeta1.js
ig.baked=true;ig.module('game.entities.planeta1').requires('impact.entity').defines(function(){EntityPlaneta1=ig.Entity.extend({size:{x:1,y:1},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:11,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/planet1.png',14,13),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',1,[0]);},update:function(){this.pos.x=170+ig.game.dia;}})});

// lib/game/entities/planeta2.js
ig.baked=true;ig.module('game.entities.planeta2').requires('impact.entity').defines(function(){EntityPlaneta2=ig.Entity.extend({size:{x:1,y:1},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:11,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/planet2.png',9,9),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('idle',1,[0]);},update:function(){this.pos.x=150+ig.game.dia*2;}})});

// lib/game/entities/carne.js
ig.baked=true;ig.module('game.entities.carne').requires('impact.entity').defines(function(){EntityCarne=ig.Entity.extend({size:{x:57,y:48},collides:ig.Entity.COLLIDES.NEVER,type:ig.Entity.TYPE.NONE,zIndex:25,animSheet:new ig.AnimationSheet('<?echo $folder;?>/media/carne-57x48-9x159.png',57,48),init:function(x,y,settings){this.parent(x,y,settings);this.addAnim('carne1',1,[0]);this.addAnim('carne2',1,[1]);this.addAnim('carne3',1,[2]);this.addAnim('carne4',1,[3]);},update:function(){this.parent();if(ig.game.comida>30)this.currentAnim=this.anims.carne4;if(ig.game.comida<=30)this.currentAnim=this.anims.carne3;if(ig.game.comida<=16)this.currentAnim=this.anims.carne2;if(ig.game.comida<=6)this.currentAnim=this.anims.carne1;}})});

// lib/game/main.js
ig.baked=true;ig.module('game.main').requires('impact.game','impact.font','plugins.tween','game.entities.fade','game.entities.fondo','game.entities.dialogbox','game.entities.prota','game.entities.accion','game.entities.perrito','game.entities.soldado','game.entities.cientifico','game.entities.doctor','game.entities.chica','game.entities.robot','game.entities.hoguera','game.entities.radio','game.entities.nave','game.entities.agua','game.entities.planeta1','game.entities.planeta2','game.entities.carne').defines(function(){Title=ig.Game.extend({font:new ig.Font('<?echo $folder;?>/media/outlinedfont.png'),fontg:new ig.Font('<?echo $folder;?>/media/outlinedfontg.png'),fontdialog:new ig.Font('<?echo $folder;?>/media/04b03.font.png'),fontdialogg:new ig.Font('<?echo $folder;?>/media/04b03.font_green.png'),scroll:new ig.Timer(),texto:'2257 AD',tpos:215,showtitle:false,showclick:false,titulo:new ig.Image('<?echo $folder;?>/media/titulo.png'),viento:new ig.Sound('<?echo $folder;?>/media/wind1.ogg'),init:function(){ig.music.add(this.viento);ig.music.volume=0.3;ig.music.play();ig.input.bind(ig.KEY.MOUSE1,'clic');this.texto='2257 AD\n\n';this.texto+='Sgt. Burden leads a research team for the Everdusk Company\n';this.texto+='for the Universe Knowledge (E.C.U.K.). His crew was gathering\n';this.texto+='information about the Medusea virus, original from the Sineicos\n';this.texto+='planet, when they got attacked by a group of bioterrist known\n';this.texto+='as XENOLIFER. Their research was stolen and, on the wrong hands\n';this.texto+='it could mean the end of the cyberwars and the beginning of the\n';this.texto+='spacial terror era.\n\n';this.texto+='In order to stop that, they should survive on the arid fields\n';this.texto+='of Sineicos, overcome famine, cold, madness, and repair\n';this.texto+='their Radio Station to send a message to the Orbital Convoy which\n';this.texto+='will cross the Sineicos surface in about 40 days: their only way out.\n';this.texto+='In addition, the Medusea virus, best known for paralizing its\n';this.texto+='victims body, will hunt them if they don\'t watch out.\n';this.texto+='\n\n';this.texto+='You are Sgt. Burden. And remember...\n';},update:function(){this.parent();if(this.scroll.delta()>0.01){this.tpos-=0.12;this.scroll.reset();}
if(ig.input.pressed('clic')&&this.showtitle)ig.system.setGame(MyGame);if(ig.input.pressed('clic')||this.tpos<-120){this.showtitle=true;setTimeout(function(){ig.game.showclick=true;},1200);}},draw:function(){this.parent();if(!this.showtitle)this.fontdialog.draw(this.texto,ig.system.width/2,this.tpos,ig.Font.ALIGN.CENTER);if(this.showtitle)this.titulo.draw(0,0);if(this.showclick)this.fontdialog.draw('Click to start',ig.system.width/2,170,ig.Font.ALIGN.CENTER);}});MyGame=ig.Game.extend({font:new ig.Font('<?echo $folder;?>/media/outlinedfont.png'),fontg:new ig.Font('<?echo $folder;?>/media/outlinedfontg.png'),fontdialog:new ig.Font('<?echo $folder;?>/media/04b03.font.png'),fontdialogg:new ig.Font('<?echo $folder;?>/media/04b03.font_green.png'),gravity:0,autoSort:true,medicinas:1,balas:26,comida:30,fuego:0,radiostatus:0,radiomax:50,locura:[14,9,7,6],locuramax:[15,10,8,7],infectado:[false,false,false,false],infeccion:[0,0,0,0],hablado:[false,false,false,false],acciones:5,supervivientes:5,hambre:6,dia:0,cuentaatras:'40 days left',over:false,resumen:'',titulofin:'',finales:['You died of hypothermia','Wild predators ravaged your camp\nbecause you didn\'t have enough bullets','You wasn\'t able to contact the orbital convoy','You escaped from the planet!','Sgt Burden failed his men and committed suicide',],fin:3,titulo:new ig.Image('<?echo $folder;?>/media/titulo.png'),planeta1:new ig.Image('<?echo $folder;?>/media/planet1.png'),planeta2:new ig.Image('<?echo $folder;?>/media/planet2.png'),showtitle:false,dialogos:[['Don\'t understimate hunger, keep the camp provided with food\nand we will be able to fight any threat.','Marvin is an excellent hunter, but there\'s nothing like a rifle.\nAnyways, I love this dog.','We are too many to feed. Our provisions won\'t last long.','Keep an eye on the ammo stock, it\'s not only valuable\nto get food, but to defend ourselves.','The dog is named Marvin after a comrade I lost\non the hydrophospore fields, It was a harsh battle...',],['We are highly exposed to the Medusea virus here. Keep always an\neye on us, if someone got paralyzed he\'ll die in 3 days.','I believe that someone infected with the Medusea will get his \nphysiology frozen, neither needing to eat or feel sorrow.','This is an everlasting cigarrette, it\'s harmless but tastes\nlike the good old ones.','The corpses from the Medusea victims are highly contagious.\nWe should burn them if the time arrives.','I expect from you that in case of emergency the dog\nwill fall before a human... Am I right?',],['I can work on the radio, but I think it will take about\n15 days to get it fixed.','Soldier, Doctor, Me and Sarah: that is the order of\n BR4ND-0N\'s psychoanalysis. Closer to 0 means worse.','Sarah and I been married for 7 years now, she is great.\nShe will surely help us to get over this.','If you have to make a hard decisson, take me before her, please.\nBR4ND-0N can continue my work perfectly.','I know that the Soldier doesn\'t like me, I hope he won\'t\ndo nothing stupid...',],['We trust you sarge. The morale is crucial in this situation.\nTry to keep the mood of the team by talking to them.','If someone of the group dies the morale will fall drastically\nSome will be more affected than others depending on who.','Don\'t let Marvin die, we all love him.\nIt would be a hard strike to the camp\'s mood.','Donald isn\'t very charismatic, but he is very good hearted.','This book talks about a boy who freed old earth with an old\ncomputer. The title says: The Legend of the Keymasher.',],['A 40 days lasting fire huh...\nI\'ll take that as a metaphor. We won\'t perish.','I should save one bullet for me?\nDon\'t think about that...','The dog looks tasty...','The engineer is pretty fat, he can probably become\na lot of food.','BR4ND-0N batteries could be used to refill the laser ammo.','The zone is inhabited by wild predators,\nWe should save ammo for fighting them.','If I escape this planet, I\'ll join next Ludum Dare','I\'m tired of eating meat. Some potatoes will be great.',]],dialogosindex:[0,0,0,0,0],opciones:[],fondo:new ig.Image('<?echo $folder;?>/media/fondo.png'),ost:new ig.Sound('<?echo $folder;?>/media/watching4.ogg'),aullido:new ig.Sound('<?echo $folder;?>/media/growl.ogg'),hoguera:new ig.Sound('<?echo $folder;?>/media/hoguera.ogg'),laser:new ig.Sound('<?echo $folder;?>/media/laser.ogg'),rugido:new ig.Sound('<?echo $folder;?>/media/rugido.ogg'),pasos:new ig.Sound('<?echo $folder;?>/media/snow_steps.ogg'),fogata:new ig.Music(),bgm:new ig.Music(),init:function(){ig.game.bgm.add(this.ost);ig.game.fogata.add(this.hoguera);ig.music.fadeOut(7);ig.game.bgm.volume=0.3;ig.game.bgm.play();ig.input.bind(ig.KEY._1,'1');ig.input.bind(ig.KEY._2,'2');ig.input.bind(ig.KEY._3,'3');ig.input.bind(ig.KEY._4,'4');ig.input.bind(ig.KEY._5,'5');ig.input.bind(ig.KEY._6,'6');ig.input.bind(ig.KEY._7,'7');ig.input.bind(ig.KEY._8,'8');ig.input.bind(ig.KEY.R,'R');ig.input.bind(ig.KEY.T,'T');ig.input.bind(ig.KEY.Y,'Y');ig.input.bind(ig.KEY.U,'U');ig.input.bind(ig.KEY.I,'I');ig.input.bind(ig.KEY.O,'O');ig.input.bind(ig.KEY.MOUSE1,'clic');ig.game.spawnEntity(EntityFondo,0,0);ig.game.spawnEntity(EntityAgua,6,84);ig.game.spawnEntity(EntityPlaneta1,150,33);ig.game.spawnEntity(EntityPlaneta2,170,42);ig.game.fade=ig.game.spawnEntity(EntityFade,0,0);ig.game.dialogbox=ig.game.spawnEntity(EntityDialogbox,0,-45);ig.game.prota=ig.game.spawnEntity(EntityProta,180,300);ig.game.doctor=ig.game.spawnEntity(EntityDoctor,82,121);ig.game.soldado=ig.game.spawnEntity(EntitySoldado,7,109);ig.game.cientifico=ig.game.spawnEntity(EntityCientifico,234,105);ig.game.chica=ig.game.spawnEntity(EntityChica,102,114);ig.game.perrito=ig.game.spawnEntity(EntityPerrito,9,142);ig.game.robot=ig.game.spawnEntity(EntityRobot,247,113);ig.game.carne=ig.game.spawnEntity(EntityCarne,9,159);ig.game.hoguera=ig.game.spawnEntity(EntityHoguera,146,129);ig.game.radio=ig.game.spawnEntity(EntityRadio,245,127);this.predator1=9+Math.floor(Math.random()*4);this.predator2=28+Math.floor(Math.random()*4);ig.game.fade.tween({opacidad:0},2,{easing:ig.Tween.Easing.Quadratic.EaseInOut,onComplete:function(){ig.game.cuentaatras='';}}).start();ig.game.spawnEntity(EntityAccion,216,145,{size:{x:30,y:15},hover:'Meds',opciones:[{texto:'Count stock',coste:0,accion:function(){ig.game.dialogbox.texto=ig.game.medicinas+' Meds left';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}]});ig.game.spawnEntity(EntityAccion,11,172,{size:{x:55-11,y:194-172},hover:'Food',opciones:[{texto:'Count stock',coste:0,accion:function(){ig.game.dialogbox.texto='We have '+ig.game.comida+' rations of food';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}]});ig.game.spawnEntity(EntityAccion,81,135,{size:{x:101-81,y:149-135},hover:'Ammo',opciones:[{texto:'Count stock',coste:0,accion:function(){ig.game.dialogbox.texto='We have '+ig.game.balas+' laser rounds left';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}]});ig.game.spawnEntity(EntityAccion,282,140,{size:{x:311-282,y:165-140},hover:'Radio',opciones:[{texto:'Examine',coste:0,accion:function(){if(ig.game.radiostatus>=ig.game.radiomax){ig.game.dialogbox.texto='FINALLY. The radio is working. I hope they hear our S.O.S. signal.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}else{ig.game.dialogbox.texto='This is our only way out, we should fix it before\nthe 40th day.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}}]});ig.game.spawnEntity(EntityAccion,159,157,{size:{x:195-159,y:173-157},hover:'Fireplace',opciones:[{texto:'Watch Fire',coste:0,accion:function(){ig.game.dialogbox.texto=ig.game.dialogos[4][ig.game.dialogosindex[4]];ig.game.dialogosindex[4]++;if(ig.game.dialogosindex[4]==ig.game.dialogos[4].length)ig.game.dialogosindex[4]=0;ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}},{texto:'Add wood',coste:1,accion:function(){ig.game.dialogbox.texto='Sgt Burden got some wood for the fireplace';ig.game.dialogbox.nombre='Fireplace revived';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.fuego=3;ig.game.acciones--;ig.game.fogata.play();}}).start();}}]});ig.game.doctoraction=ig.game.spawnEntity(EntityAccion,101,122,{size:{x:121-101,y:155-122},hover:'Doctor',opciones:[{texto:'Talk',coste:1,accion:function(){ig.game.dialogbox.texto=ig.game.dialogos[1][ig.game.dialogosindex[1]];ig.game.dialogosindex[1]++;if(ig.game.dialogosindex[1]==ig.game.dialogos[1].length)ig.game.dialogosindex[1]=0;ig.game.dialogbox.nombre='Doctor';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.locura[1]+=1;ig.game.hablado[1]=true;ig.game.acciones--;}}).start();}},{texto:'Prepare Medicine',coste:1,accion:function(){var vacunas=Math.floor(Math.random()*2+1);ig.game.dialogbox.texto='I know some herbs on this planet that will be useful.\n[Doctor made '+vacunas+' vaccine/s!]';ig.game.dialogbox.nombre='Doctor';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.medicinas+=vacunas;ig.game.acciones--;}}).start();}},{texto:'Repair Radio',coste:1,accion:function(){if(ig.game.radiostatus>=ig.game.radiomax){ig.game.dialogbox.texto='I think that the radio is already working.';ig.game.dialogbox.nombre='Doctor';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}else{ig.game.dialogbox.texto='OK. I\'ll see what can I do...\n[THE DOCTOR REPAIRED 2% OF THE RADIO]';ig.game.dialogbox.nombre='Doctor';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.radiostatus+=1;ig.game.acciones--;}}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.muerte(1);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo... I\'ll feel so bad\nkilling him with a rock or something...';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},],infecciones:[{texto:'Talk',coste:0,accion:function(){ig.game.dialogbox.texto='Doctor? All you allright? ...\nI think he may be infected by the Medusea';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}},{texto:'Cure',coste:1,accion:function(){if(ig.game.medicinas>0){ig.game.dialogbox.texto='Wha-what happened? Oh, I see.. I must been caught by the\nMedusea virus, thanks for saving me.';ig.game.dialogbox.nombre='Doctor';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.medicinas--;ig.game.acciones--;ig.game.supervivientes++;ig.game.hambre++;ig.game.infectado[1]=false;ig.game.doctoraction.infectado=false;}}).start();}else{ig.game.dialogbox.texto='Damn... We ran out of medicine... Sorry Doctor.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.supervivientes++;ig.game.hambre++;ig.game.muerte(1);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo... I\'ll feel so bad\nkilling him with a rock or something...';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},]});ig.game.cientificoaction=ig.game.spawnEntity(EntityAccion,234,104,{size:{x:255-234,y:140-107},hover:'Engineer',opciones:[{texto:'Talk',coste:1,accion:function(){ig.game.dialogbox.texto=ig.game.dialogos[2][ig.game.dialogosindex[2]];ig.game.dialogosindex[2]++;if(ig.game.dialogosindex[2]==ig.game.dialogos[2].length)ig.game.dialogosindex[2]=0;ig.game.dialogbox.nombre='The Engineer';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.locura[2]+=1;ig.game.hablado[2]=true;ig.game.acciones--;}}).start();}},{texto:'Repair Radio',coste:1,accion:function(){if(ig.game.radiostatus>=ig.game.radiomax){ig.game.dialogbox.texto='The work is done, boss. Just keep us alive until\nthe orbital convoy arrives!';ig.game.dialogbox.nombre='The Engineer';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}else{ig.game.dialogbox.texto='Let\'s repair this junk.\n[THE ENGINEER REPAIRED 6% OF THE RADIO]';ig.game.dialogbox.nombre='The Engineer';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.radiostatus+=3;ig.game.acciones--;}}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.muerte(2);ig.game.balas--;}else{ig.game.dialogbox.texto='I don\'t like him, but killing him without\nweapons would be so sadist';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},],infecciones:[{texto:'Talk',coste:0,accion:function(){ig.game.dialogbox.texto='Hey man, are you thinking or something?\nOh, crap... he got infected.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}},{texto:'Cure',coste:1,accion:function(){if(ig.game.medicinas>0){ig.game.dialogbox.texto='I had a dream... I was having lunch at mom\'s...\nThanks for saving me, anyway.';ig.game.dialogbox.nombre='Engineer';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.medicinas--;ig.game.acciones--;ig.game.supervivientes++;ig.game.hambre++;ig.game.infectado[2]=false;ig.game.cientificoaction.infectado=false;}}).start();}else{ig.game.dialogbox.texto='We\'ll need some meds for waking him up';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.supervivientes++;ig.game.hambre++;ig.game.muerte(2);ig.game.balas--;}else{ig.game.dialogbox.texto='I don\'t like him, but killing him without\nweapons would be so sadist';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},]});ig.game.soldadoaction=ig.game.spawnEntity(EntityAccion,48,110,{size:{x:61-48,y:164-110},hover:'Soldier',opciones:[{texto:'Talk',coste:1,accion:function(){ig.game.dialogbox.texto=ig.game.dialogos[0][ig.game.dialogosindex[0]];ig.game.dialogosindex[0]++;if(ig.game.dialogosindex[0]==ig.game.dialogos[0].length)ig.game.dialogosindex[0]=0;ig.game.dialogbox.nombre='Soldier';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.locura[0]+=1;ig.game.hablado[0]=true;ig.game.acciones--;}}).start();}},{texto:'Hunt: Cost 1-3 bullets, 90% Success',coste:1,accion:function(){if(ig.game.balas>2){ig.game.laser.play();var disparos=Math.floor(Math.random()*3+1);ig.game.balas-=disparos;if(Math.floor(Math.random()*10>1)){var comida=5+Math.floor(Math.random()*3+1);ig.game.comida+=comida;ig.game.dialogbox.texto='Soldier spent '+disparos+' bullets and got '+comida+' rations of food';ig.game.dialogbox.nombre='Hunt results';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.acciones--;}}).start();}else{ig.game.dialogbox.texto='Soldier spent '+disparos+' bullets but the hunt was unsuccesful';ig.game.dialogbox.nombre='Hunt results';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.acciones--;}}).start();}}else{ig.game.dialogbox.texto='We ran our of ammo, sir. I\'m sorry. If there\'s any round\nleft, use it to break the robot. We could use his batteries.';ig.game.dialogbox.nombre='Soldier';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.muerte(0);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo... I won\'t be able to kill him\nwith my bare hads.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},],infecciones:[{texto:'Talk',coste:0,accion:function(){ig.game.dialogbox.texto='Did you see something? Stay alert.\nHi? Are you there? Oh... Medusea got him.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}},{texto:'Cure',coste:1,accion:function(){if(ig.game.medicinas>0){ig.game.dialogbox.texto='SIR! THANKS FOR SPENDING VALUABLE RESOURCES\nON THIS WEAK SOLDIER, SIR!';ig.game.dialogbox.nombre='Soldier';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.medicinas--;ig.game.acciones--;ig.game.supervivientes++;ig.game.hambre++;ig.game.infectado[0]=false;ig.game.soldadoaction.infectado=false;}}).start();}else{ig.game.dialogbox.texto='He was a great comrade. I\'d like to save him.\nWe need meds.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.supervivientes++;ig.game.hambre++;ig.game.muerte(0);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo...\nIt\'s not honorable stab a frozen soldier.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},]});ig.game.perritoaction=ig.game.spawnEntity(EntityAccion,17,143,{size:{x:33-17,y:171-143},hover:'Marvin',opciones:[{texto:'Pet',coste:0,accion:function(){ig.game.dialogbox.texto='Woof!';ig.game.dialogbox.nombre='Marvin';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}},{texto:'Hunt: Cost 0 bullets, 60% Success',coste:1,accion:function(){if(Math.floor(Math.random()*100>34)){var comida=4+Math.floor(Math.random()*2+1);ig.game.comida+=comida;ig.game.dialogbox.texto='Marvin got '+comida+' rations of food!';ig.game.dialogbox.nombre='Hunt results';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.acciones--;}}).start();}else{ig.game.dialogbox.texto='Marvin wasn\'t able to catch any animal';ig.game.dialogbox.nombre='Hunt results';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.acciones--;}}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.muerte(5);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo... And Marvin is so cute...';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},]});ig.game.robotaction=ig.game.spawnEntity(EntityAccion,261,121,{size:{x:275-261,y:168-121},hover:'BR4ND-0N',opciones:[{texto:'Request Inform',coste:1,accion:function(){ig.game.dialogbox.texto='Phycho-Analysis: '+ig.game.locura[0]+' , '+ig.game.locura[1]+' , '+ig.game.locura[2]+' , '+ig.game.locura[3];ig.game.dialogbox.texto+='\nRadio repair: '+parseInt(ig.game.radiostatus)+' / '+ig.game.radiomax;ig.game.dialogbox.nombre='BR4ND-0N';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){}}).start();}},{texto:'Repair Radio',coste:1,accion:function(){if(ig.game.radiostatus>=ig.game.radiomax){ig.game.dialogbox.texto='The radio is already repaired, sir!';ig.game.dialogbox.nombre='BR4ND-0N';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}else{ig.game.dialogbox.texto='The Engineer should be more effective, but I\'ll do my best.\n[BR4ND-0N REPAIRED 4% OF THE RADIO]';ig.game.dialogbox.nombre='BR4ND-0N';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.radiostatus+=2;ig.game.acciones--;}}).start();}}},{texto:'Destroy',coste:1,accion:function(){if(ig.game.balas>0){ig.game.muerte(4);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo... It won\'t break easily...';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},]});ig.game.chicaaction=ig.game.spawnEntity(EntityAccion,130,115,{size:{x:146-130,y:146-115},hover:'Psychiatrist',opciones:[{texto:'Talk',coste:1,accion:function(){ig.game.dialogbox.texto=ig.game.dialogos[3][ig.game.dialogosindex[3]];ig.game.dialogosindex[3]++;if(ig.game.dialogosindex[3]==ig.game.dialogos[3].length)ig.game.dialogosindex[3]=0;ig.game.dialogbox.nombre='Psychiatrist';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.locura[3]+=1;ig.game.hablado[3]=true;ig.game.acciones--;}}).start();}},{texto:'Group therapy (All actions)',coste:ig.game.supervivientes,accion:function(){if(ig.game.acciones>=ig.game.supervivientes){ig.game.dialogbox.texto='Listen!! This will be the greatest challenge an Eversdusk Team\never faced, but we shall prevail and tell our story!';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){for(var i=0;i<ig.game.locura.length;i++)if(ig.game.locura[i]>=0&&!ig.game.infectado[i])ig.game.locura[i]+=Math.floor(Math.random()*3+1);for(var i=0;i<ig.game.locura.length;i++)if(ig.game.locura[i]>=0)ig.game.hablado[i]=true;ig.game.acciones=0;}}).start();}else{ig.game.dialogbox.texto='I\'m sorry sarge, We don\'t have time for that today.\n[You need ALL actions]';ig.game.dialogbox.nombre='Psychiatrist';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.muerte(3);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo and I won\'t kill a girl by beating her.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},],infecciones:[{texto:'Talk',coste:0,accion:function(){ig.game.dialogbox.texto='Listen... Sometimes I have strange dreams with my spaceship.\nHey! Are you listening? Shit, Medusea virus.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}},{texto:'Cure',coste:1,accion:function(){if(ig.game.medicinas>0){ig.game.dialogbox.texto='Where, When, What... ?\nOh, I see... thanks for saving me, sarge.';ig.game.dialogbox.nombre='Psychiatrist';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut,onComplete:function(){ig.game.medicinas--;ig.game.acciones--;ig.game.supervivientes++;ig.game.hambre++;ig.game.infectado[3]=false;ig.game.chicaaction.infectado=false;}}).start();}else{ig.game.dialogbox.texto='Poor girl, we are out of meds.';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},{texto:'Kill',coste:1,accion:function(){if(ig.game.balas>0){ig.game.supervivientes++;ig.game.hambre++;ig.game.muerte(3);ig.game.balas--;}else{ig.game.dialogbox.texto='I\'m out of ammo... I don\'t feel like beating her to death';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}},]});},update:function(){this.parent();if(ig.game.acciones>0){if(ig.input.pressed('1')){ig.game.fuego=4;ig.game.acciones--;}
if(ig.input.pressed('2')){ig.game.balas-=Math.floor(Math.random()*2+1);if(Math.floor(Math.random()*10>1)){ig.game.comida+=4+Math.floor(Math.random()*2+1);}else{alert('hunt failed');}
ig.game.acciones--;}
if(ig.input.pressed('3')){ig.game.radiostatus+=2;ig.game.acciones--;}
if(ig.input.pressed('4')){ig.game.locura[0]+=1;ig.game.hablado[0]=true;ig.game.acciones--;}
if(ig.input.pressed('5')){ig.game.locura[1]+=1;ig.game.hablado[1]=true;ig.game.acciones--;}
if(ig.input.pressed('6')){ig.game.locura[2]+=1;ig.game.hablado[2]=true;ig.game.acciones--;}
if(ig.input.pressed('7')){ig.game.locura[3]+=1;ig.game.hablado[3]=true;ig.game.acciones--;}
if(ig.input.pressed('8')){ig.game.acciones--;}
if(ig.input.pressed('R')){ig.game.muerte(0);}
if(ig.input.pressed('T')){ig.game.muerte(1);}
if(ig.input.pressed('Y')){ig.game.muerte(2);}
if(ig.input.pressed('U')){ig.game.muerte(3);}
if(ig.input.pressed('I')){ig.game.muerte(4);}
if(ig.input.pressed('O')){ig.game.muerte(5);}}else if(ig.game.dialogbox.pos.y<=-ig.game.dialogbox.size.y){if(ig.game.fade.opacidad<=0){ig.game.fade.tween({opacidad:1},2,{easing:ig.Tween.Easing.Quadratic.EaseInOut,onComplete:function(){ig.game.comida-=ig.game.hambre;if(ig.game.comida<0)ig.game.comida=0;ig.game.fuego--;if(ig.game.fuego<0){ig.game.fin=0;ig.game.over=true;ig.game.dialogbox.texto='You forgot to maintain the fireplace lit.\n';ig.game.dialogbox.texto+='Everyone froze during the night.';ig.game.dialogbox.nombre='Remember the fire';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}
if(ig.game.perrito.currentAnim==ig.game.perrito.anims.morir)ig.game.perrito.kill();if(ig.game.soldado.currentAnim==ig.game.soldado.anims.morir)ig.game.soldado.kill();if(ig.game.doctor.currentAnim==ig.game.doctor.anims.morir)ig.game.doctor.kill();if(ig.game.chica.currentAnim==ig.game.chica.anims.morir)ig.game.chica.kill();if(ig.game.cientifico.currentAnim==ig.game.cientifico.anims.morir)ig.game.cientifico.kill();if(ig.game.robot.currentAnim==ig.game.robot.anims.morir)ig.game.robot.kill();for(var i=0;i<4;i++){if(!ig.game.hablado[i]&&!ig.game.infectado[i])ig.game.locura[i]-=2;if(ig.game.locura[i]>ig.game.locuramax[i])ig.game.locura[i]=ig.game.locuramax[i];ig.game.hablado[i]=false;}
for(var i=0;i<4;i++){if(ig.game.comida<=0)ig.game.locura[i]-=4;}
ig.game.dia++;if(ig.game.dia==ig.game.predator1-1||ig.game.dia==ig.game.predator2-1)ig.game.aullido.play();if(ig.game.dia==ig.game.predator1||ig.game.dia==ig.game.predator2){ig.game.rugido.play();var tiros=4+Math.floor(Math.random()*4);if(tiros<=ig.game.balas){var zampa=3+Math.floor(Math.random()*5);ig.game.dialogbox.texto='You kicked them out of the camp. You needed '+tiros+' bullets,\n';ig.game.dialogbox.texto+='but they took '+zampa+' rations of food. The group morale is low.';ig.game.dialogbox.nombre='WILD PREDATORS ATTACKED THIS NIGHT!!';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();ig.game.balas-=tiros;ig.game.comida-=zampa;if(ig.game.comida<0)ig.game.comida=0;for(var i=0;i<4;i++)if(!ig.game.infectado[i])ig.game.locura[i]-=3;}else{ig.game.fin=1;ig.game.over=true;ig.game.dialogbox.texto='You needed '+tiros+' bullets, but only had '+ig.game.balas+'\n';ig.game.dialogbox.texto+='You fought hard, but succumbed to their power.';ig.game.dialogbox.nombre='WILD PREDATORS ATTACKED THIS NIGHT!!';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}}
var locos='';for(var i=0;i<4;i++){if(ig.game.locura[i]<0&&ig.game.locura[i]>-20){ig.game.huir(i);if(i==0)locos+='The Soldier, ';if(i==1)locos+='The Doctor, ';if(i==2)locos+='The Engineer, ';if(i==3)locos+='The Psychiatrist, ';}}
if(locos!=''){locos+='became mad and ran away,\n we probably won\'t meet again.'
ig.game.dialogbox.texto=locos;ig.game.dialogbox.nombre='Broke down';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();}
if(Math.random()*100<19){var virus=Math.floor(Math.random()*4);if(!ig.game.infectado[virus]&&ig.game.locura[virus]>-20){ig.game.infectado[virus]=true;if(virus==0)ig.game.soldadoaction.infectado=true;if(virus==1)ig.game.doctoraction.infectado=true;if(virus==2)ig.game.cientificoaction.infectado=true;if(virus==3)ig.game.chicaaction.infectado=true;ig.game.supervivientes--;ig.game.hambre--;}}
var baja='';for(var i=0;i<ig.game.infeccion.length;i++){ig.game.infectado[i]?ig.game.infeccion[i]++:ig.game.infeccion[i]=0;if(ig.game.infeccion[i]>=4&&ig.game.locura[i]>-20){baja='\n';if(i==0)baja+='The Soldier ';if(i==1)baja+='The Doctor ';if(i==2)baja+='The Engineer ';if(i==3)baja+='The Psychiatrist ';baja+='died of Medusea,\nthe toxic meat has been incinerated';ig.game.supervivientes++;ig.game.hambre++;ig.game.huir(i);}}
ig.game.acciones=ig.game.supervivientes;if(ig.game.acciones<=0)ig.game.acciones=1;var killhim=true;for(var i=0;i<ig.game.locura.length;i++)if(ig.game.locura[i]>-20)killhim=false;if(killhim){ig.game.over=true;ig.game.fin=4;}
if(ig.game.dia>=40){if(ig.game.radiostatus>=ig.game.radiomax){ig.game.dialogbox.texto='WE MADE IT! We are leaving this wasted planet!\nLOOK! The Orbital Convoy!!!';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();ig.game.spawnEntity(EntityNave,100,-100);}else{ig.game.dialogbox.texto='It\'s the day! We survived! But the radio is not working...\nNow we are stuck here forever...';ig.game.dialogbox.nombre='Sgt Burden';ig.game.dialogbox.tween({pos:{y:0}},1,{easing:ig.Tween.Easing.Quadratic.EaseOut}).start();ig.game.over=true;ig.game.fin=2;}}
if(ig.game.over){ig.game.titulofin="GODS HAVE BEEN WATCHING";ig.game.resumen="You survived for "+ig.game.dia+" days\n\n";ig.game.resumen+=ig.game.finales[ig.game.fin];ig.game.resumen+="\n\nYou had "+ig.game.balas+" bullets, "+ig.game.comida+" rations of food\nand "+ig.game.medicinas+" meds left";if(ig.game.radiostatus>=ig.game.radiomax){ig.game.resumen+="\nYou repaired de radio succesfully!";}else{ig.game.resumen+="\nRadio reparation: "+ig.game.radiostatus+" of "+ig.game.radiomax;}
ig.game.resumen+='\n\nTHANK YOU FOR PLAYING'
ig.game.resumen+='\n\nPress F5 to Try Again'}else{ig.game.cuentaatras=(40-ig.game.dia)+" days left"+baja;ig.game.fade.tween({opacidad:0},2,{easing:ig.Tween.Easing.Quadratic.EaseInOut,delay:2,onComplete:function(){ig.game.cuentaatras='';}}).start();}}}).start();}}},muerte:function(id){ig.game.prota.currentAnim=ig.game.prota.anims.disparar.rewind();ig.game.laser.play();switch(id){case 0:ig.game.soldado.currentAnim=ig.game.soldado.anims.morir.rewind();ig.game.soldadoaction.kill();ig.game.comida+=17;ig.game.locura[0]=-100;ig.game.locura[1]-=1;ig.game.locura[2]-=0;ig.game.locura[3]-=2;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;case 1:ig.game.doctor.currentAnim=ig.game.doctor.anims.morir.rewind();ig.game.doctoraction.kill();ig.game.comida+=15;ig.game.locura[1]=-100;ig.game.locura[0]-=3;ig.game.locura[2]-=1;ig.game.locura[3]-=1;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;case 2:ig.game.cientifico.currentAnim=ig.game.cientifico.anims.morir.rewind();ig.game.cientificoaction.kill();ig.game.comida+=21;ig.game.locura[2]=-100;ig.game.locura[0]+=1;ig.game.locura[1]-=1;ig.game.locura[3]-=3;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;case 3:ig.game.chica.currentAnim=ig.game.chica.anims.morir.rewind();ig.game.chicaaction.kill();ig.game.comida+=12;ig.game.locura[3]=-100;ig.game.locura[0]-=2;ig.game.locura[1]-=1;ig.game.locura[2]-=3;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;case 4:ig.game.robot.currentAnim=ig.game.robot.anims.morir.rewind();ig.game.robotaction.kill();ig.game.balas+=30;ig.game.locura[0]-=0;ig.game.locura[1]-=3;ig.game.locura[2]-=2;ig.game.locura[3]-=0;ig.game.acciones--;ig.game.supervivientes--;break;case 5:ig.game.perrito.currentAnim=ig.game.perrito.anims.morir.rewind();ig.game.perritoaction.kill();ig.game.comida+=10;ig.game.locura[0]-=3;ig.game.locura[1]-=2;ig.game.locura[2]-=1;ig.game.locura[3]-=1;ig.game.hambre--;ig.game.acciones--;break;}},huir:function(id){switch(id){case 0:ig.game.soldado.kill();ig.game.soldadoaction.kill();ig.game.locura[0]=-100;ig.game.locura[1]-=1;ig.game.locura[2]-=0;ig.game.locura[3]-=2;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;case 1:ig.game.doctor.kill();ig.game.doctoraction.kill();ig.game.locura[1]=-100;ig.game.locura[0]-=3;ig.game.locura[2]-=1;ig.game.locura[3]-=1;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;case 2:ig.game.cientifico.kill();ig.game.cientificoaction.kill();ig.game.locura[2]=-100;ig.game.locura[0]+=1;ig.game.locura[1]-=1;ig.game.locura[3]-=3;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;case 3:ig.game.chica.kill();ig.game.chicaaction.kill();ig.game.locura[3]=-100;ig.game.locura[0]-=2;ig.game.locura[1]-=1;ig.game.locura[2]-=3;ig.game.hambre--;ig.game.acciones--;ig.game.supervivientes--;break;}},draw:function(){this.parent();this.fontg.draw(ig.game.titulofin,ig.system.width/2,50,ig.Font.ALIGN.CENTER);this.fontdialog.draw(ig.game.resumen,ig.system.width/2,70,ig.Font.ALIGN.CENTER);this.font.draw(this.cuentaatras,ig.system.width/2,ig.system.height/2-10,ig.Font.ALIGN.CENTER);if(!ig.game.over&&ig.game.dia<40)this.font.draw('Actions: '+this.acciones,ig.system.width-5,ig.system.height-11,ig.Font.ALIGN.RIGHT);if(this.showtitle)this.titulo.draw(0,0);},isClick:function(target){var mx=ig.input.mouse.x;var my=ig.input.mouse.y;if(mx>target.pos.x&&mx<target.pos.x+target.size.x&&my>target.pos.y&&my<target.pos.y+target.size.y)return true;}});ig.main('#canvas',Title,60,320,215,3);});
</script>
</div>
